using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Forms;
using DevExpress.XtraEditors;
using DBHesabdari_PG;
using System.Data.Entity;
using KharidVaFroosh.AmaliatFrooshVKharid;
using DevExpress.XtraGrid.Views.Grid;
using HelpClassLibrary;
using DBHesabdari_PG.Models.EP.CodingHesabdari;
using DBHesabdari_PG.Models.FK;
using DevExpress.XtraGrid;
using DevExpress.XtraTab;
using System.Collections;

namespace FrooshVKharid.AmaliatFrooshVKharid
{
    public partial class FrmFactor : DevExpress.XtraEditors.XtraForm
    {
        public int _SalId = 0;
        MyContext dbContext;
        public FrmFactor()
        {
            InitializeComponent();
            //_SalId = Convert.ToInt32(lblSalId.Text);

            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpListAnbarhas.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epListAnbarhasBindingSource.DataSource = dbContext.EpListAnbarhas.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Where(s => s.Id == 0).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Kala.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            // dbContext = new MyContext();
            // Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpNameAdresss.Where(s => s.SalId == _SalId).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epNameAdresssBindingSource.DataSource = dbContext.EpNameAdresss.Local.ToBindingList();
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            ////DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpNameOstans.Where(s => s.SalId == _SalId).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epNameOstansBindingSource.DataSource = dbContext.EpNameOstans.Local.ToBindingList();
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            ////DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpNameShahrstans.Where(s => s.SalId == _SalId).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epNameShahrstansBindingSource.DataSource = dbContext.EpNameShahrstans.Local.ToBindingList();
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            ////DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpNoeArzs.Where(s => s.SalId == _SalId).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epNoeArzsBindingSource.DataSource = dbContext.EpNoeArzs.Local.ToBindingList();
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            ////DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpHesabTafsiliAshkhass.Where(s => s.SalId == _SalId && s.IsRanande).Load();
            // This line of code is generated by Data Source Configuration Wizard
            //epHesabTafsiliAshkhassBindingSource.DataSource = dbContext.EpHesabTafsiliAshkhass.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            // Call the Load method to get the data for the given DbSet from the database.
            ///dbContext.EpHesabTafsiliAshkhass.Where(s => s.SalId == _SalId && s.IsVizitor).Load();
            // This line of code is generated by Data Source Configuration Wizard
            //epHesabTafsiliAshkhassBindingSource1.DataSource = dbContext.EpHesabTafsiliAshkhass.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            // Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpDarsadVizitor_As.Where(s => s.SalId == _SalId).Load();
            // This line of code is generated by Data Source Configuration Wizard
            //epDarsadVizitor_AsBindingSource.DataSource = dbContext.EpDarsadVizitor_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            // Call the Load method to get the data for the given DbSet from the database.
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpDarsadTakhfif_As.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epDarsadTakhfif_AsBindingSource.DataSource = dbContext.EpDarsadTakhfif_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            // Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpAdress_As.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epAdress_AsBindingSource.DataSource = dbContext.EpAdress_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpShTamas_As.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epShTamas_AsBindingSource.DataSource = dbContext.EpShTamas_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpMoshakhasat_As.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epMoshakhasat_AsBindingSource.DataSource = dbContext.EpMoshakhasat_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpHesabBanki_As.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epHesabBanki_AsBindingSource.DataSource = dbContext.EpHesabBanki_As.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Ksorat.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
        }

        FrmListFrooshVKharid Fm;
        public FrmFactor(FrmListFrooshVKharid fm)
        {
            InitializeComponent();
            Fm = fm;
            //// This line of code is generated by Data Source Configuration Wizard
            //// Instantiate a new DBContext
            //DBHesabdari_PG.MyContext dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.EpListAnbarhas.Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //epListAnbarhasBindingSource.DataSource = dbContext.EpListAnbarhas.Local.ToBindingList();
            // This line of code is generated by Data Source Configuration Wizard
            // Instantiate a new DBContext
            //dbContext = new MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Where(s => s.Id == 0).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Kala.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
            //dbContext = new DBHesabdari_PG.MyContext();
            //// Call the Load method to get the data for the given DbSet from the database.
            //dbContext.FkAmaliatFrooshVKharid_Rizs.Where(s => s.Id == 0).Load();
            //// This line of code is generated by Data Source Configuration Wizard
            //fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.DataSource = dbContext.FkAmaliatFrooshVKharid_Rizs.Local.ToBindingList();
        }




        public bool _FirstSelectAnbar_NextSanad = false;
        public EnumCED En1 = EnumCED.Cancel;
        public EnumCED En2;
        public int? _AnbarId = null;
        public int? _VizitorId = null;
        public int? _Ez_KsId = null;
        public int? _BeforEditAnbarId = null;
        public int? _KalaId = null;
        //public int? _VahedeKalaId = null;
        public string _AnbarName_NM = null;
        //public string _VizitorName_NM = null;
        public string _KalaCode_NM = null;
        public string _KalaName_NM = null;
        public string _VahedeKala_NM = null;
        public decimal _Meghdar = 0;
        public decimal _Nerkh = 0;
        public decimal _Mablag = 0;
        public decimal? _Motefareghe = null;
        public decimal? TakhfifRadifiKala = null;
        public decimal? _Maliat = null;
        public decimal? _Avarez = null;
        public string _Tozihat = null;
        public int _RowHandle = 0;
        public int _HesabMoinId_Bed = 0;
        public int _HesabTafsili1Id_Bed = 0;
        public int _HesabTafsili2Id_Bed = 0;
        public int _HesabTafsili3Id_Bed = 0;
        public int _HesabMoinId_Bes = 0;
        public int _HesabTafsili1Id_Bes = 0;
        public int _HesabTafsili2Id_Bes = 0;
        public int _HesabTafsili3Id_Bes = 0;
        public string _SharhSanad = null;
        public int _NameSanadIndex = 0;
        public int _NameAmaliatCode = 0;
        public int _NameSanadCode = 0;
        public string _NameSanadText = string.Empty;
        public byte _NoeFactor = 0;
        public int _NoeSanadIndex = -1;
        public string _NoeSanadText = string.Empty;
        //public int _NoeSanadIndex_Khadamat = -1;
        //public string _NoeSanadText_Khadamat = string.Empty;
        public int? _SanadMabnaId = null;
        public int? _SefareshId = null;
        //public string _NoeAghlamText = string.Empty;
        //public int _NoeAghlamIndex = 0;
        //public GridControl gridControl;
        //public GridView gridView;
        public GridControl gridControl1;
        public GridView gridView1;
        //bool IsClosed_AmaliatFooeshVKharid = true;


        public int _FNumber_BeNameAmaliat_BeSelectAnbar = 0;
        //public int _FNumber_BaNameAmaliat_BeSelectAnbar = 0;
        public int _FNumberCol_BaNameSanad_BeSelectAnbar = 0;
        //public int _FNumber_BaNameAmaliat_BaSelectAnbar = 0;
        public int _FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
        public int _FNumberJoze_BaNameSanad_BaNoeFactor = 0;

        public int _SNumber_BeNameAmaliat_BeSelectAnbar = 0;
        //public int _SNumber_BaNameAmaliat_BeSelectAnbar = 0;
        public int _SNumberCol_BaNameSanad_BeSelectAnbar = 0;
        //public int _SNumber_BaNameAmaliat_BaSelectAnbar = 0;
        public int _SNumberJoze_BaNameSanad_BaSelectAnbar = 0;


        public void FillCmbAnbarName()
        {
            using (var db = new MyContext())
            {
                try
                {
                    _SalId = Convert.ToInt32(lblSalId.Text);

                    var q1 = db.EpListAnbarhas.Where(s => s.SalId == _SalId).OrderBy(s => s.Code).ToList();
                    if (q1.Count > 0) epListAnbarhasBindingSource.DataSource = q1; else epListAnbarhasBindingSource.Clear();

                    //var q = db.EpListAnbarhas.Where(s => s.SalId == _SalId).ToList();

                    #region MyRegion
                    //var q1 = db.EpListAnbarhas.Where(s => s.SalId == _SalId && s.IsActive == true).OrderBy(s => s.Code).ToList();

                    //foreach (var item in q1)
                    //{
                    //    IList<int> List1 = new List<int>();
                    //    string _Id1 = String.Empty;
                    //    if (item.TabagheKalaId != null)
                    //    {
                    //        char[] item1 = item.TabagheKalaId.ToArray();
                    //        for (int i = 0; i < item1.Count(); i++)
                    //        {
                    //            if (i == 0)
                    //            {
                    //                _Id1 = _Id1 + item1[i].ToString();
                    //            }
                    //            else
                    //            {
                    //                if (item1[i] == ',')
                    //                {
                    //                    int _Id2 = Convert.ToInt32(_Id1);
                    //                    List1.Add(_Id2);
                    //                    _Id1 = String.Empty;
                    //                }
                    //                else
                    //                {
                    //                    _Id1 = _Id1 + item1[i].ToString();
                    //                }

                    //            }
                    //        }

                    //        string _KalaId = String.Empty;
                    //        foreach (var item2 in List1)
                    //        {
                    //            _KalaId += db.EpTabaghehKalas.FirstOrDefault(s => s.SalId == _SalId && s.Id == item2).Name + ",";
                    //        }
                    //        item.TabagheKalaIdName_NM = _KalaId;
                    //    }

                    //}
                    //if (q1.Count > 0)
                    //    epListAnbarhasBindingSource.DataSource = q1;
                    //else
                    //    epListAnbarhasBindingSource.Clear();

                    #endregion

                    //var q2 = db.EpTabaghehKalas.Where(s => s.SalId == _SalId).ToList();
                    //foreach (var item in q1)
                    //{
                    //    var qq = db.R_EpListAnbarha_B_EpTabaghehKalas.Where(s => s.SalId == _SalId && s.AnbarhId == item.Id).Select(s => s.TabagheKalaId).ToList();
                    //    if (qq.Count > 0)
                    //    {
                    //        string _TabagheKalaName = String.Empty;
                    //        foreach (var item2 in qq)
                    //        {
                    //            _TabagheKalaName += q2.FirstOrDefault(s => s.Id == item2).Name + ",";
                    //        }
                    //        item.TabagheKalaIdName_NM = _TabagheKalaName;
                    //    }
                    //}


                    //_SalId = Convert.ToInt32(lblSalId.Text);
                    //var q = db.EpListAnbarhas.Where(s => s.SalId == _SalId && s.IsActive == true).OrderBy(s => s.Code).ToList();
                    //cmbNameAnbar.Properties.DataSource = q.Count > 0 ? q : null;
                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }

        private void FrmFactor_Load(object sender, EventArgs e)
        {
            //using (var db = new MyContext())
            {
                try
                {
                    _SalId = Convert.ToInt32(lblSalId.Text);
                    dbContext = new MyContext();
                    HelpClass1.DateTimeMask(txtTarikhSanad);
                    HelpClass1.DateTimeMask(txtTarikhPaygiri);
                    HelpClass1.DateTimeMask(txtAzTarikh);
                    HelpClass1.DateTimeMask(txtTaTarikh);
                    HelpClass1.DateTimeMask(txtTaEngheza_E);

                    var q = dbContext.TzTanzimatSystems.FirstOrDefault(s => s.KeyId == 4401001);
                    if (q != null)
                        _FirstSelectAnbar_NextSanad = q.IsChecked;

                    //XtraTabControl1_SelectedPageChanged(null, null);
                    XtraTabControl1.SelectedTabPageIndex = 0;
                    XtraTabControl1.SelectedTabPageIndex = 1;
                    XtraTabControl1.SelectedTabPageIndex = 2;
                    XtraTabControl1.SelectedTabPageIndex = 3;
                    XtraTabControl1.SelectedTabPageIndex = 4;
                    XtraTabControl1.SelectedTabPageIndex = 0;

                    if (this.Name == "FrmFactorFrooshKala")
                    {
                        cmbNameSanad.BackColor = Color.GreenYellow;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش");
                        //cmbNameSanad.Properties.Items.Add("فاکتور فروش خدمات");
                        //cmbNameSanad.Properties.Items.Add("سفارش فروش خدمات");

                        //cmbNoeSanad_AghlamKhadamat.Visible = false;
                        //cmbNoeSanad_AghlamKala.Size = new Size(342, 30);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع فروش کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("فروش کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("فروش کالای صادراتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع فروش خدمات";
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("فروش خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("فروش خدمات خارجی");

                        this.Text = "فاکتور فروش کالا";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 201;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 0;
                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";
                        lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = true;
                        if (_FirstSelectAnbar_NextSanad)
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;

                    }
                    else if (this.Name == "FrmFactorFrooshKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.Honeydew;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(342, 30);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع فروش خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("فروش خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("فروش خدمات خارجی");

                        this.Text = "فاکتور فروش خدمات";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 201;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 0;
                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = true;
                    }
                    else if (this.Name == "FrmFactorBargashtAzFrooshKala")
                    {
                        cmbNameSanad.BackColor = Color.Yellow;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش");
                        //cmbNameSanad.Properties.Items.Add("فاکتور فروش خدمات");
                        //cmbNameSanad.Properties.Items.Add("سفارش فروش خدمات");

                        cmbNoeSanad.Properties.NullValuePrompt = "نوع برگشت کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("برگشت کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("برگشت کالای صادراتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع برگشت خدمات";
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("برگشت خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("برگشت خدمات خارجی");


                        this.Text = "فاکتور برگشت از فروش کالا";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 202;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 1;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";
                        lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = true;
                        if (_FirstSelectAnbar_NextSanad)
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;

                    }
                    else if (this.Name == "FrmFactorBargashtAzFrooshKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.Chocolate;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(384, 34);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع برگشت خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("برگشت خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("برگشت خدمات خارجی");

                        this.Text = "فاکتور برگشت از فروش خدمات";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 202;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 1;
                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        //lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = false;
                        lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = true;
                    }
                    else if (this.Name == "FrmSefareshFrooshKala")
                    {
                        cmbNameSanad.BackColor = Color.SkyBlue;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش");

                        cmbNoeSanad.Properties.NullValuePrompt = "نوع سفارش کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("سفارش کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("سفارش کالای صادراتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع سفارش خدمات";
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("سفارش خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("سفارش خدمات خارجی");

                        this.Text = "سفارش فروش کالا";
                        lblTarikh.Text = "تاریخ سفارش";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 203;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 2;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش سفارش جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش سفارش کل";

                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSabetAtefNumber.Visible = txtSabetAtefNumber.Visible = false;
                        lblGhateySanadNumber.Visible = txtGhateySanadNumber.Visible = false;
                        lblRozaneSanadNumber.Visible = txtRozaneSanadNumber.Visible = chkEditCode.Visible = false;
                        //lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = false;
                        //lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = false;
                        if (_FirstSelectAnbar_NextSanad)
                        {
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;
                            lblFNumberJoze_BaNameSanad_BaSelectAnbar.Text = "ش سفارش با توجه به انبار";
                        }

                    }
                    else if (this.Name == "FrmSefareshFrooshKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.HotPink;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از فروش خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش فروش خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(384, 34);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع سفارش خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("سفارش خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("سفارش خدمات خارجی");

                        this.Text = "سفارش فروش خدمات";
                        lblTarikh.Text = "تاریخ سفارش";
                        _NameAmaliatCode = 2;
                        _NameSanadCode = 203;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 2;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش سفارش جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش سفارش کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSabetAtefNumber.Visible = txtSabetAtefNumber.Visible = false;
                        lblGhateySanadNumber.Visible = txtGhateySanadNumber.Visible = false;
                        lblRozaneSanadNumber.Visible = txtRozaneSanadNumber.Visible = chkEditCode.Visible = false;
                        //lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = false;
                        //lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = false;
                    }
                    else if (this.Name == "FrmFactorKharidKala")
                    {
                        cmbNameSanad.BackColor = Color.LightCoral;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید");

                        cmbNoeSanad.Properties.NullValuePrompt = "نوع خرید کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("خرید کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("خرید کالای وارداتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع خرید خدمات";
                        ///cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("خرید خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("خرید خدمات خارجی");

                        this.Text = "فاکتور خرید کالا";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 101;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 0;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";
                        lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = true;
                        if (_FirstSelectAnbar_NextSanad)
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;

                    }
                    else if (this.Name == "FrmFactorKharidKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.LightBlue;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(384, 34);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع خرید خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("خرید خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("خرید خدمات خارجی");

                        this.Text = "فاکتور خرید خدمات";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 101;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 0;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = true;

                    }
                    else if (this.Name == "FrmFactorBargashtAzKharidKala")
                    {
                        cmbNameSanad.BackColor = Color.Cyan;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید");

                        cmbNoeSanad.Properties.NullValuePrompt = "نوع برگشت کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("برگشت کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("برگشت کالای وارداتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع خرید خدمات";
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("برگشت خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("برگشت خدمات خارجی");

                        this.Text = "فاکتور برگشت از خرید کالا";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 102;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 1;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";
                        lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = true;
                        if (_FirstSelectAnbar_NextSanad)
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;

                    }
                    else if (this.Name == "FrmFactorBargashtAzKharidKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.Azure;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(384, 34);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع خرید خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("برگشت خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("برگشت خدمات خارجی");

                        this.Text = "فاکتور برگشت از خرید خدمات";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 102;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 1;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش فاکتور جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش فاکتور کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = true;

                    }
                    else if (this.Name == "FrmSefareshKharidKala")
                    {
                        cmbNameSanad.BackColor = Color.Pink;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید");

                        cmbNoeSanad.Properties.NullValuePrompt = "نوع سفارش کالا";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("سفارش کالای داخلی");
                        cmbNoeSanad.Properties.Items.Add("سفارش کالای وارداتی");

                        //cmbNoeSanad_AghlamKhadamat.Properties.NullValuePrompt = "نوع سفارش خدمات";
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Clear();
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("سفارش خدمات داخلی");
                        //cmbNoeSanad_AghlamKhadamat.Properties.Items.Add("سفارش خدمات خارجی");

                        this.Text = "سفارش خرید کالا";
                        lblTarikh.Text = "تاریخ سفارش";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 103;
                        _NoeFactor = 0;
                        cmbNameSanad.SelectedIndex = 2;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش سفارش جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش سفارش کل";

                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSabetAtefNumber.Visible = txtSabetAtefNumber.Visible = false;
                        lblGhateySanadNumber.Visible = txtGhateySanadNumber.Visible = false;
                        lblRozaneSanadNumber.Visible = txtRozaneSanadNumber.Visible = chkEditCode.Visible = false;
                        //lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = false;
                        //lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = false;
                        if (_FirstSelectAnbar_NextSanad)
                        {
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = lblFNumberJoze_BaNameSanad_BaSelectAnbar.Visible = true;
                            lblFNumberJoze_BaNameSanad_BaSelectAnbar.Text = "ش سفارش با توجه به انبار";
                        }

                    }
                    else if (this.Name == "FrmSefareshKharidKhadamat")
                    {
                        cmbNameSanad.BackColor = Color.Pink;
                        cmbNameSanad.Properties.Items.Clear();
                        cmbNameSanad.Properties.Items.Add("فاکتور خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("فاکتور برگشت از خرید خدمات");
                        cmbNameSanad.Properties.Items.Add("سفارش خرید خدمات");

                        //cmbNoeSanad_AghlamKala.Visible = false;
                        //cmbNoeSanad_AghlamKhadamat.Size = new Size(384, 34);
                        cmbNoeSanad.Properties.NullValuePrompt = "نوع سفارش خدمات";
                        cmbNoeSanad.Properties.Items.Clear();
                        cmbNoeSanad.Properties.Items.Add("سفارش خدمات داخلی");
                        cmbNoeSanad.Properties.Items.Add("سفارش خدمات خارجی");


                        this.Text = "سفارش خرید خدمات";
                        lblTarikh.Text = "تاریخ سفارش";
                        _NameAmaliatCode = 1;
                        _NameSanadCode = 103;
                        _NoeFactor = 1;
                        cmbNameSanad.SelectedIndex = 2;

                        lblFNumberJoze_BaNameSanad_BaNoeFactor.Text = "ش سفارش جزء";
                        lblFNumberCol_BaNameSanad_BeSelectAnbar.Text = "ش سفارش کل";

                        xtp_NerkhAghlamKala.PageVisible = xtp_MojodiAghlamKala.PageVisible = false;
                        //xtp_Ranande.PageVisible = xtp_Sayer.PageVisible = false;
                        txtMabKhalesKala.Visible = lblMabKhalesKala.Visible = false;
                        lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                        lblSNumberCol_BaNameSanad_BeSelectAnbar.Visible = txtSNumberCol_BaNameSanad_BeSelectAnbar.Visible = false;
                        lblSabetAtefNumber.Visible = txtSabetAtefNumber.Visible = false;
                        lblGhateySanadNumber.Visible = txtGhateySanadNumber.Visible = false;
                        lblRozaneSanadNumber.Visible = txtRozaneSanadNumber.Visible = chkEditCode.Visible = false;
                        //lblSanadMabna.Visible = cmbSanadMabna.Visible = btnRemoveSanadMabna.Visible = false;
                        //lblSefaresh.Visible = cmbSefaresh.Visible = btnRemoveSefaresh.Visible = false;
                    }

                    if (En1 == EnumCED.Create)
                        cmbNoeSanad.SelectedIndex = 0;

                    if (_FirstSelectAnbar_NextSanad)
                    {
                        if (_NoeFactor == 0)
                        {
                            FillCmbAnbarName();
                            if (Fm != null)
                            {
                                cmbNameAnbar.EditValue = _AnbarId;
                            }
                            if (Convert.ToInt32(cmbNameAnbar.EditValue) != 0)
                                panelControl_NameAnbar.Enabled = false;
                            //gridView.Columns["SeryalCol_BaNameAmaliat_BeSelectAnbar"].Visible = false;
                            //gridView.Columns["SeryalJoze_BaNameSanad_BeSelectAnbar"].Visible = false;
                            //lblSeryalCol_BaNameAmaliat_BeSelectAnbar.Visible = txtSeryalCol_BaNameAmaliat_BeSelectAnbar.Visible = false;
                            //lblSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = txtSNumberJoze_BaNameSanad_BaSelectAnbar.Visible = false;
                            //cmbNameAnbar.Focus();

                        }
                        else if (_NoeFactor == 1)
                        {
                            panelControl_NameAnbar.Enabled = false;
                            panelControl_NameAnbar.Visible = false;
                            panelControl_NameAnbar.Width = 0;
                            xtp_AghlamKala.PageVisible = false;
                        }
                    }
                    else
                    {
                        panelControl_NameAnbar.Enabled = false;
                        panelControl_NameAnbar.Visible = false;
                        panelControl_NameAnbar.Width = 0;
                        xtp_AghlamKala.PageVisible = _NoeFactor == 1 ? false : true;
                    }

                    if (En1 == EnumCED.Edit)
                    {
                        var q1 = dbContext.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.FNumber_BeNameAmaliat_BeSelectAnbar == _FNumber_BeNameAmaliat_BeSelectAnbar && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                        int _Id = Convert.ToInt32(Fm.gridView_List.GetFocusedRowCellValue("Id"));
                        cmbNameSanad.SelectedIndex = q1.FirstOrDefault(s => s.Id == _Id).NameSanadIndex;
                        cmbNoeSanad.SelectedIndex = q1.FirstOrDefault(s => s.Id == _Id).NoeSanadIndex;
                        //cmbNoeSanad_AghlamKhadamat.SelectedIndex = q1.FirstOrDefault(s => s.Id == _Id).NoeSanadIndex_Khadamat;
                        cmbSefaresh.EditValue = q1.FirstOrDefault(s => s.Id == _Id).SefareshId;
                        cmbSanadMabna.EditValue = q1.FirstOrDefault(s => s.Id == _Id).SanadMabnaId;
                        txtFNumberJoze_BaNameSanad_BaNoeFactor.Text = q1.FirstOrDefault(s => s.Id == _Id).FNumberJoze_BaNameSanad_BaNoeFactor.ToString();
                        txtFNumberCol_BaNameSanad_BeSelectAnbar.Text = q1.FirstOrDefault(s => s.Id == _Id).FNumberCol_BaNameSanad_BeSelectAnbar.ToString();
                        if (_FirstSelectAnbar_NextSanad)
                        {
                            cmbNameAnbar.EditValue = q1.FirstOrDefault(s => s.Id == _Id).AnbarId;
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text = q1.FirstOrDefault(s => s.Id == _Id).FNumberJoze_BaNameSanad_BaSelectAnbar.ToString();
                            txtSNumberJoze_BaNameSanad_BaSelectAnbar.Text = q1.FirstOrDefault(s => s.Id == _Id).SNumberJoze_BaNameSanad_BaSelectAnbar.ToString();

                        }
                        txtSNumberCol_BaNameSanad_BeSelectAnbar.Text = q1.FirstOrDefault(s => s.Id == _Id).SNumberJoze_BaNameSanad_BaSelectAnbar.ToString();

                        txtTarikhSanad.Text = q1.FirstOrDefault(s => s.Id == _Id).DateTimeSanad.ToString();
                        if (q1.FirstOrDefault(s => s.Id == _Id).GhateySanadNamber != null)
                            txtGhateySanadNumber.Text = q1.FirstOrDefault(s => s.Id == _Id).GhateySanadNamber.ToString();
                        //if (q1.FirstOrDefault(s=>s.Id== _Id).SabetAtefNumber > 0)
                        txtSabetAtefNumber.Text = q1.FirstOrDefault(s => s.Id == _Id).SabetAtefNumber.ToString();
                        // if (q1.FirstOrDefault(s=>s.Id== _Id).SabetAtefNumber > 0)
                        txtRozaneSanadNumber.Text = q1.FirstOrDefault(s => s.Id == _Id).RozaneSanadNumber.ToString();
                        if (q1.FirstOrDefault(s => s.Id == _Id).PaygiriNumber != null)
                            txtPaygiriNumber.Text = q1.FirstOrDefault(s => s.Id == _Id).PaygiriNumber.ToString();
                        if (q1.FirstOrDefault(s => s.Id == _Id).DateTimePaygiri != null)
                            txtTarikhPaygiri.Text = q1.FirstOrDefault(s => s.Id == _Id).DateTimePaygiri.ToString();
                        if (this.Name == "FrmFactorFrooshKala" || this.Name == "FrmFactorFrooshKhadamat" || this.Name == "FrmSefareshFrooshKala"
                            || this.Name == "FrmSefareshFrooshKhadamat" || this.Name == "FrmFactorBargashtAzKharidKala" || this.Name == "FrmFactorBargashtAzKharidKhadamat")
                        {
                            cmbHesabMoin.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabMoinId_Bed;
                            cmbHesabTafsili1.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili1Id_Bed;
                            cmbHesabTafsili2.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili2Id_Bed;
                            cmbHesabTafsili3.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili3Id_Bed;
                        }
                        else if (this.Name == "FrmFactorKharidKala" || this.Name == "FrmFactorKharidKhadamat" || this.Name == "FrmSefareshKharidKala"
                            || this.Name == "FrmSefareshKharidKhadamat" || this.Name == "FrmFactorBargashtAzFrooshKala" || this.Name == "FrmFactorBargashtAzFrooshKhadamat")
                        {
                            cmbHesabMoin.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabMoinId_Bes;
                            cmbHesabTafsili1.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili1Id_Bes;
                            cmbHesabTafsili2.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili2Id_Bes;
                            cmbHesabTafsili3.EditValue = q1.FirstOrDefault(s => s.Id == _Id).HesabTafsili3Id_Bes;

                        }

                        if (q1.FirstOrDefault(s => s.Id == _Id).SharhSanad != null)
                            txtSharhSanad.Text = q1.FirstOrDefault(s => s.Id == _Id).DateTimePaygiri.ToString();

                        foreach (var item in q1)
                        {
                            if (item.KalaId != null)
                            {
                                item.KalaCode_NM = new MyContext().EpNameKalas.FirstOrDefault(s => s.Id == item.KalaId).Code.ToString();
                                item.KalaName_NM = new MyContext().EpNameKalas.FirstOrDefault(s => s.Id == item.KalaId).Name;
                                item.VahedeKala_NM = new MyContext().EpNameKalas.FirstOrDefault(s => s.Id == item.KalaId).EpVahedAsliKala.Name;

                                if (item.NoeFactor == 0 && item.AnbarId != null)
                                    item.AnbarName_NM = new MyContext().EpListAnbarhas.FirstOrDefault(s => s.Id == item.AnbarId).Name;

                            }
                            else if (item.Ez_KsId != null)
                            {
                                item.KalaCode_NM = new MyContext().FKTarifEz_Ks_Factors.FirstOrDefault(s => s.Id == item.Ez_KsId).Code.ToString();
                                item.KalaName_NM = new MyContext().FKTarifEz_Ks_Factors.FirstOrDefault(s => s.Id == item.Ez_KsId).Name;

                            }
                            else if (item.VizitorId != null)
                            {
                                item.KalaCode_NM = new MyContext().EpHesabTafsiliAshkhass.FirstOrDefault(s => s.Id == item.VizitorId).Code.ToString();
                                item.KalaName_NM = new MyContext().EpHesabTafsiliAshkhass.FirstOrDefault(s => s.Id == item.VizitorId).Name;

                            }

                        }

                        if (_NoeFactor == 0)
                        {
                            var p1 = q1.Where(s => s.KalaId != null && s.AnbarId != null && s.IndexAghlamFactor == 0).ToList();
                            if (p1.Count() > 0)
                                fkAmaliatFrooshVKharid_RizsBindingSource_Kala.DataSource = p1.ToList();
                            else
                                fkAmaliatFrooshVKharid_RizsBindingSource_Kala.Clear();
                        }

                        var p2 = q1.Where(s => s.KalaId != null && s.AnbarId == null && s.IndexAghlamFactor == 1).ToList();
                        if (p2.Count() > 0)
                            fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.DataSource = p2.ToList();
                        else
                            fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.Clear();

                        var p3 = q1.Where(s => s.Ez_KsId != null && s.KalaId == null && s.AnbarId == null && s.VizitorId == null).ToList();
                        if (p3.Where(s => s.IndexAghlamFactor == 2).Count() > 0)
                            fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.DataSource = p3.Where(s => s.IndexAghlamFactor == 2).ToList();
                        else
                            fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.Clear();

                        if (p3.Where(s => s.IndexAghlamFactor == 3).Count() > 0)
                            fkAmaliatFrooshVKharid_RizsBindingSource_Ksorat.DataSource = p3.Where(s => s.IndexAghlamFactor == 3).ToList();
                        else
                            fkAmaliatFrooshVKharid_RizsBindingSource_Ksorat.Clear();

                        var p5 = q1.Where(s => s.VizitorId != null && s.AnbarId == null && s.KalaId == null && s.Ez_KsId == null && s.IndexAghlamFactor == 4).ToList();
                        if (p5.Count() > 0)
                            fkAmaliatFrooshVKharid_RizsBindingSource_Vizitor.DataSource = p5.ToList();
                        else
                            fkAmaliatFrooshVKharid_RizsBindingSource_Vizitor.Clear();
                    }
                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }

            //En1 = EnumCED.None;
            //ActiveButtons();
            //NameAmaliatTabpageIndex = 0;
            //NameAmaliatTabpageName = xtcAmaliatRozaneh.SelectedTabPage.Name;
            //_NameAmaliatCode = 2;
            //_NameSanadCode = 201;
            //// xtcAmaliatRozaneh.SelectedTabPageIndex = 0;
            //NameSanadTabpageIndex = 0;
            //XtraTabControl1_1 = xtc_VorodeKala;
            //NameSanadTabpageName = XtraTabControl1_1.SelectedTabPage.Name;
            //NameSanadText = XtraTabControl1_1.SelectedTabPage.Text;
            //xtcAmaliatRozaneh.SelectedTabPageIndex = 0;
            //gridControl = gridControl_AllVorode;
            //gridView = gridView_AllVorode;
            //xtcAmaliatRozaneh.SelectedTabPageIndex = 0;
            //        xtcAmaliatRozaneh_SelectedPageChanged(null, null);
            //xtc_VorodeKala.SelectedTabPageIndex = 0;
            //objGridControl = new GridControl();
            //objGridControl = gridControl_AllVorode;
            //gridControl_AllVorode.DataBindings.Clear();
            //xtp_ResidJabejaee.Controls.Add(gc);

            // XtraTabControl1_1.SelectedTabPageIndex = 0;
            //FillCmbNameAnbar();
            //textEdit1.Focus();

            //panelControl1_2.Width = 0;
            //panelControl1_2.Height = 364;


        }


        private void btnInsert1_Click(object sender, EventArgs e)
        {
            En2 = EnumCED.Create;
            FrmSelectKala fm = new FrmSelectKala(this);
            if (XtraTabControl1.SelectedTabPage == xtp_AghlamKala)
            {
                if (_FirstSelectAnbar_NextSanad && _NoeFactor == 0)
                {
                    fm._AnbarId = _AnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                    if (_AnbarId == 0)
                    {
                        cmbNameAnbar.ShowPopup();
                        cmbNameAnbar.Focus();
                        return;
                    }
                    //fm.BeAnbarId  = Convert.ToInt32(cmbBeAnbar.EditValue);
                }
                fm.gridControl = gridControl_AghlamKala;
                fm.gridView = gridView_AghlamKala;
                //fm.btnInsert = btnInsert1;

            }
            else if (XtraTabControl1.SelectedTabPage == xtp_AghlamKhadamat)
            {
                fm.gridControl = gridControl_AghlamKhadamat;
                fm.gridView = gridView_AghlamKhadamat;

            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ezafat)
            {
                fm.gridControl = gridControl_Ezafat;
                fm.gridView = gridView_Ezafat;

            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ksorat)
            {
                fm.gridControl = gridControl_Ksorat;
                fm.gridView = gridView_Ksorat;

            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Vizitor)
            {
                fm.gridControl = gridControl_Vizitor;
                fm.gridView = gridView_Vizitor;

            }


            //fm.MdiParent = this;
            fm.lblUserId.Text = lblUserId.Text;
            fm.lblUserName.Text = lblUserName.Text;
            fm.lblSalId.Text = lblSalId.Text;
            fm.lblSalMali.Text = lblSalMali.Text;
            fm.Text = "ایجاد رکورد جدید";
            fm.ShowDialog();

        }

        private void btnEdit1_Click(object sender, EventArgs e)
        {
            //gridControl1 = new GridControl();
            //gridView1 = new GridView();
            En2 = EnumCED.Edit;
            FrmSelectKala fm = new FrmSelectKala(this);
            if (XtraTabControl1.SelectedTabPage == xtp_AghlamKala)
            {
                fm.gridControl = gridControl_AghlamKala;
                fm.gridView = gridView_AghlamKala;
                fm.btnEdit = btnEdit1;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_AghlamKhadamat)
            {
                fm.gridControl = gridControl_AghlamKhadamat;
                fm.gridView = gridView_AghlamKhadamat;
                fm.btnEdit = btnEdit1;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ezafat)
            {
                fm.gridControl = gridControl_Ezafat;
                fm.gridView = gridView_Ezafat;
                fm.btnEdit = btnEdit1;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ksorat)
            {
                fm.gridControl = gridControl_Ksorat;
                fm.gridView = gridView_Ksorat;
                fm.btnEdit = btnEdit1;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Vizitor)
            {
                fm.gridControl = gridControl_Vizitor;
                fm.gridView = gridView_Vizitor;
                fm.btnEdit = btnEdit1;
            }

            if (gridView1.RowCount > 0)
            {
                if (objXtraTabPage_1 == xtp_AghlamKala || objXtraTabPage_1 == xtp_AghlamKhadamat)
                {
                    _AnbarId = fm._AnbarId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("AnbarId"));
                    _KalaId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("KalaId"));
                }
                else if (objXtraTabPage_1 == xtp_Ezafat || objXtraTabPage_1 == xtp_Ksorat)
                    _Ez_KsId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("Ez_KsId"));
                else if (objXtraTabPage_1 == xtp_Vizitor)
                    _VizitorId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("VizitorId"));
                // _BeAnbarId = fm.BeAnbarId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("BeAnbarId"));
                //_VahedeKalaId = Convert.ToInt32(gridView1.GetFocusedRowCellValue("VahedeKalaId"));
                //_KalaCode_NM = gridView_AmaliatAddVaEdit.GetFocusedRowCellDisplayText("KalaCode");
                //_KalaName_NM = gridView_AmaliatAddVaEdit.GetFocusedRowCellDisplayText("KalaName");
                _Meghdar = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Meghdar"));
                _Nerkh = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Nerkh"));
                _Mablag = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Mablag"));
                _Motefareghe = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Motefareghe"));
                TakhfifRadifiKala = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("TakhfifRadifiKala"));
                _Maliat = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Maliat"));
                _Avarez = Convert.ToDecimal(gridView1.GetFocusedRowCellValue("Avarez"));
                if (gridView1.GetFocusedRowCellValue("Tozihat") != null)
                    _Tozihat = gridView1.GetFocusedRowCellValue("Tozihat").ToString();
                _RowHandle = gridView1.FocusedRowHandle;
                _HesabMoinId_Bed = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabMoinId_Bed"));
                _HesabTafsili1Id_Bed = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili1Id_Bed"));
                _HesabTafsili2Id_Bed = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili2Id_Bed"));
                _HesabTafsili3Id_Bed = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili3Id_Bed"));
                _HesabMoinId_Bes = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabMoinId_Bes"));
                _HesabTafsili1Id_Bes = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili1Id_Bes"));
                _HesabTafsili2Id_Bes = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili2Id_Bes"));
                _HesabTafsili3Id_Bes = Convert.ToInt32(gridView1.GetFocusedRowCellValue("HesabTafsili3Id_Bes"));

                //fm.MdiParent = this;
                fm.lblUserId.Text = lblUserId.Text;
                fm.lblUserName.Text = lblUserName.Text;
                fm.lblSalId.Text = lblSalId.Text;
                fm.lblSalMali.Text = lblSalMali.Text;
                //fm.AzAnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                fm.ShowDialog();

            }

        }

        private void gridView_CustomDrawRowIndicator(object sender, DevExpress.XtraGrid.Views.Grid.RowIndicatorCustomDrawEventArgs e)
        {
            GridView view = sender as GridView;
            HelpClass1.CustomDrawRowIndicator(sender, e, view);

        }

        public void FillCmbHesabMoin()
        {
            using (var db = new MyContext())
            {
                try
                {
                    _SalId = Convert.ToInt32(lblSalId.Text);
                    var q = db.EpHesabMoin1s.Where(s => s.SalId == _SalId).OrderBy(s => s.Code).ToList();
                    if (En1 == EnumCED.Edit)
                        cmbHesabMoin.Properties.DataSource = q.Count > 0 ? q : null;
                    else
                        cmbHesabMoin.Properties.DataSource = q.Where(s => s.IsActive == true).ToList().Count > 0 ? q.Where(s => s.IsActive == true).ToList() : null;
                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }

        public void FillCmbHesabTafsili()
        {
            using (var db = new MyContext())
            {
                try
                {
                    _SalId = Convert.ToInt32(lblSalId.Text);
                    _HesabMoinId_Bed = Convert.ToInt32(cmbHesabMoin.EditValue);

                    List<EpAllHesabTafsili> list = new List<EpAllHesabTafsili>();

                    var q1 = db.R_EpHesabMoin1_B_EpAllGroupTafsilis.Where(s => s.EpHesabMoin1Id == _HesabMoinId_Bed && s.SalId == _SalId).Select(s => s.AllGroupTafsiliId).ToList();
                    if (q1.Count > 0)
                    {
                        foreach (var item in q1)
                        {
                            var q = db.EpAllHesabTafsilis.Where(s => s.SalId == _SalId && s.GroupTafsiliId == item).OrderBy(s => s.Code).ToList();
                            list.AddRange(q);
                        }
                        #region MyRegion
                        ////db.EpAllHesabTafsilis.AddRange(list);
                        //List<EpAllHesabTafsili_HesabMovaghat> list1 = new List<EpAllHesabTafsili_HesabMovaghat>();
                        //foreach (var item in list)
                        //{
                        //    EpAllHesabTafsili_HesabMovaghat obj = new EpAllHesabTafsili_HesabMovaghat();
                        //    obj.Id = item.Id;
                        //    obj.SalId = item.SalId;
                        //    obj.LevelNumber = item.LevelNumber;
                        //    obj.Code = item.Code;
                        //    obj.Name = item.Name;
                        //    obj.GroupTafsiliId = item.GroupTafsiliId;
                        //    obj.MoinId = _HesabMoinId;
                        //    obj.IsActive = item.IsActive;
                        //    obj.IsDefault = item.IsDefault;
                        //    obj.SharhHesab = item.SharhHesab;
                        //    list1.Add(obj);
                        //}
                        //db.EpAllHesabTafsili_HesabMovaghats.AddRange(list1);

                        ////BindingSource bs = new BindingSource();
                        ////bs.DataSource = list;
                        ////BindingList<EpAllHesabTafsili> ok = new BindingList<EpAllHesabTafsili>(list);
                        //db.EpAllHesabTafsili_HesabMovaghats.Load(); 
                        #endregion
                        if (En1 == EnumCED.Create)
                        {
                            cmbHesabTafsili1.Properties.DataSource = list.Where(s => s.IsActive == true && s.LevelNumber == 1).Count() > 0 ? list.Where(s => s.IsActive == true && s.LevelNumber == 1).OrderBy(s => s.Code).ToList() : null;
                            cmbHesabTafsili2.Properties.DataSource = list.Where(s => s.IsActive == true && s.LevelNumber == 2).Count() > 0 ? list.Where(s => s.IsActive == true && s.LevelNumber == 2).OrderBy(s => s.Code).ToList() : null;
                            cmbHesabTafsili3.Properties.DataSource = list.Where(s => s.IsActive == true && s.LevelNumber == 3).Count() > 0 ? list.Where(s => s.IsActive == true && s.LevelNumber == 3).OrderBy(s => s.Code).ToList() : null;

                        }
                        else
                        {
                            cmbHesabTafsili1.Properties.DataSource = list.Where(s => s.LevelNumber == 1).OrderBy(s => s.Code);
                            cmbHesabTafsili2.Properties.DataSource = list.Where(s => s.LevelNumber == 2).OrderBy(s => s.Code);
                            cmbHesabTafsili3.Properties.DataSource = list.Where(s => s.LevelNumber == 3).OrderBy(s => s.Code);
                        }
                    }
                    else
                    {
                        cmbHesabTafsili1.Properties.DataSource = null;
                        cmbHesabTafsili2.Properties.DataSource = null;
                        cmbHesabTafsili3.Properties.DataSource = null;

                    }

                    //if (_HesabMoinId == 14)
                    //{
                    //    cmbHesabTafsili.Properties.DataSource = db.EpAllHesabTafsilis.Where(s => s.GroupTafsiliId == 1 || s.GroupTafsiliId == 2).ToList();
                    //}
                    //else if (_HesabMoinId == 15)
                    //{
                    //    cmbHesabTafsili.Properties.DataSource = db.EpAllHesabTafsilis.Where(s => s.GroupTafsiliId == 3 || s.GroupTafsiliId == 4).ToList();
                    //}

                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }

        public void gridView_InitNewRow(object sender, InitNewRowEventArgs e)
        {
            //GridView view = sender as GridView;
            //int a = gridView1.RowCount - 1;
            gridView1.SetRowCellValue(e.RowHandle, "VizitorId", _VizitorId);
            gridView1.SetRowCellValue(e.RowHandle, "Ez_KsId", _Ez_KsId);

            gridView1.SetRowCellValue(e.RowHandle, "AnbarId", _AnbarId);
            gridView1.SetRowCellValue(e.RowHandle, "AnbarName_NM", _AnbarName_NM);

            gridView1.SetRowCellValue(e.RowHandle, "KalaId", _KalaId);
            gridView1.SetRowCellValue(e.RowHandle, "KalaName_NM", _KalaName_NM);
            gridView1.SetRowCellValue(e.RowHandle, "KalaCode_NM", _KalaCode_NM);

            //gridView1.SetRowCellValue(e.RowHandle, "VahedeKalaId", _VahedeKalaId);
            gridView1.SetRowCellValue(e.RowHandle, "VahedeKala_NM", _VahedeKala_NM);

            gridView1.SetRowCellValue(e.RowHandle, "Meghdar", _Meghdar);
            gridView1.SetRowCellValue(e.RowHandle, "Nerkh", _Nerkh);
            gridView1.SetRowCellValue(e.RowHandle, "Mablag", _Mablag);
            gridView1.SetRowCellValue(e.RowHandle, "Motefareghe", _Motefareghe);
            gridView1.SetRowCellValue(e.RowHandle, "TakhfifRadifiKala", TakhfifRadifiKala);
            gridView1.SetRowCellValue(e.RowHandle, "Maliat", _Maliat);
            gridView1.SetRowCellValue(e.RowHandle, "Avarez", _Avarez);
            gridView1.SetRowCellValue(e.RowHandle, "Tozihat", _Tozihat);

            gridView1.SetRowCellValue(e.RowHandle, "HesabMoinId_Bed", _HesabMoinId_Bed);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili1Id_Bed", _HesabTafsili1Id_Bed);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili2Id_Bed", _HesabTafsili2Id_Bed);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili3Id_Bed", _HesabTafsili3Id_Bed);
            gridView1.SetRowCellValue(e.RowHandle, "HesabMoinId_Bes", _HesabMoinId_Bes);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili1Id_Bes", _HesabTafsili1Id_Bes);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili2Id_Bes", _HesabTafsili2Id_Bes);
            gridView1.SetRowCellValue(e.RowHandle, "HesabTafsili3Id_Bes", _HesabTafsili3Id_Bes);

            // gridView1.AddNewRow();
            //gridView1.FocusInvalidRow();
        }

        private void gridView_RowCellClick(object sender, RowCellClickEventArgs e)
        {
            btnDelete1.Enabled = btnEdit1.Enabled = true;
        }

        private void gridView_RowCountChanged(object sender, EventArgs e)
        {
            if (gridView1 != null)
            {
                if (_NoeFactor == 0 && gridView_AghlamKala.RowCount > 0)
                {
                    //btnDelete1.Enabled = btnEdit1.Enabled = true;
                    btnSaveAndClosed.Enabled = btnSaveAndNext.Enabled = btnSaveAndPrintAndClosed.Enabled = true;

                    if (_FirstSelectAnbar_NextSanad)
                    {
                        panelControl_NameAnbar.Enabled = false;
                    }

                }
                else if (_NoeFactor == 1 && gridView_AghlamKhadamat.RowCount > 0)
                {
                    //btnDelete1.Enabled = btnEdit1.Enabled = true;
                    btnSaveAndClosed.Enabled = btnSaveAndNext.Enabled = btnSaveAndPrintAndClosed.Enabled = true;

                    if (_FirstSelectAnbar_NextSanad)
                    {
                        panelControl_NameAnbar.Enabled = false;
                    }

                }
                else
                {
                    btnDelete1.Enabled = btnEdit1.Enabled = false;
                    btnSaveAndClosed.Enabled = btnSaveAndNext.Enabled = btnSaveAndPrintAndClosed.Enabled = false;
                    //if (_FirstSelectAnbar_NextSanad && Fm == null)
                    //{
                    //    panelControl_NameAnbar.Enabled = true;
                    //}
                }


            }
        }

        public XtraTabPage objXtraTabPage_1;
        public int _IndexNoeTabaghehKala = 0;
        public int _IndexAghlamFactor = 0;
        private void XtraTabControl1_SelectedPageChanged(object sender, DevExpress.XtraTab.TabPageChangedEventArgs e)
        {
            try
            {
                _IndexAghlamFactor = XtraTabControl1.SelectedTabPageIndex;
                objXtraTabPage_1 = new XtraTabPage();
                objXtraTabPage_1 = XtraTabControl1.SelectedTabPage;
                btnDelete1.Enabled = btnEdit1.Enabled = false;

                if (objXtraTabPage_1 == xtp_AghlamKala)
                {
                    gridControl1 = gridControl_AghlamKala;
                    gridView1 = gridView_AghlamKala;
                    _IndexNoeTabaghehKala = XtraTabControl1.SelectedTabPageIndex;
                }
                else if (objXtraTabPage_1 == xtp_AghlamKhadamat)
                {
                    gridControl1 = gridControl_AghlamKhadamat;
                    gridView1 = gridView_AghlamKhadamat;
                    _IndexNoeTabaghehKala = XtraTabControl1.SelectedTabPageIndex;
                }
                else if (objXtraTabPage_1 == xtp_Ezafat)
                {
                    gridControl1 = gridControl_Ezafat;
                    gridView1 = gridView_Ezafat;
                }
                else if (objXtraTabPage_1 == xtp_Ksorat)
                {
                    gridControl1 = gridControl_Ksorat;
                    gridView1 = gridView_Ksorat;
                }
                else if (objXtraTabPage_1 == xtp_Vizitor)
                {
                    gridControl1 = gridControl_Vizitor;
                    gridView1 = gridView_Vizitor;
                }
            }
            catch (Exception)
            {
            }

        }

        private void gridView_KeyDown(object sender, KeyEventArgs e)
        {
            gridView_RowCellClick(null, null);
        }

        private void gridView_KeyUp(object sender, KeyEventArgs e)
        {
            gridView_RowCellClick(null, null);

        }


        public bool IsValidation()
        {
            // string s = txtMeghdar.Text.Trim();
            if (cmbNameSanad.SelectedIndex < 0 || cmbNameSanad.Text == "" || string.IsNullOrEmpty(cmbNameSanad.Text))
            {
                //xtpAmaliatAddVEdit.Text = NameSanad + " : نوع سند " + ": " + cmbNameSanad.Text;
                XtraMessageBox.Show("نام سند مشخص نیست", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Information);
                //cmbNameSanad.ShowPopup();
                return false;
            }
            else if (Convert.ToInt32(cmbNameAnbar.EditValue) == 0 && _FirstSelectAnbar_NextSanad && gridView_AghlamKala.RowCount > 0 && _NoeFactor == 0)
            {
                XtraMessageBox.Show("لطفاً انبار را مشخص کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbNameAnbar.Focus();
                return false;
            }
            else if (Convert.ToInt32(cmbHesabMoin.EditValue) == 0)
            {
                XtraMessageBox.Show("لطفاً " + lblHesabMoin.Text + " را انتخاب کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbHesabMoin.Focus();
                return false;
            }
            else if (Convert.ToInt32(cmbHesabTafsili1.EditValue) == 0 && cmbHesabTafsili1.ReadOnly == false)
            {
                XtraMessageBox.Show("لطفاً " + lblHesabTafsili1.Text + " را انتخاب کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbHesabTafsili1.Focus();
                return false;
            }
            else if (Convert.ToInt32(cmbHesabTafsili2.EditValue) == 0 && cmbHesabTafsili2.ReadOnly == false)
            {
                XtraMessageBox.Show("لطفاً " + lblHesabTafsili2.Text + " را انتخاب کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbHesabTafsili2.Focus();
                return false;
            }
            else if (Convert.ToInt32(cmbHesabTafsili3.EditValue) == 0 && cmbHesabTafsili3.ReadOnly == false)
            {
                XtraMessageBox.Show("لطفاً " + lblHesabTafsili3.Text + " را انتخاب کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbHesabTafsili3.Focus();
                return false;
            }
            else if (string.IsNullOrEmpty(txtFNumberJoze_BaNameSanad_BaNoeFactor.Text))
            {
                XtraMessageBox.Show("فیلد " + lblFNumberJoze_BaNameSanad_BaNoeFactor + " خالی است ", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                txtFNumberJoze_BaNameSanad_BaNoeFactor.Focus();
                return false;
            }
            else if (string.IsNullOrEmpty(txtFNumberCol_BaNameSanad_BeSelectAnbar.Text))
            {
                XtraMessageBox.Show("فیلد " + lblFNumberCol_BaNameSanad_BeSelectAnbar + " خالی است ", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                txtFNumberCol_BaNameSanad_BeSelectAnbar.Focus();
                return false;
            }
            else if (_FirstSelectAnbar_NextSanad == true && _NoeFactor == 0 && txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text == "0")
            {
                XtraMessageBox.Show("فیلد " + lblFNumberJoze_BaNameSanad_BaSelectAnbar + " نباید صفر باشد ", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                txtFNumberJoze_BaNameSanad_BaSelectAnbar.Focus();
                return false;
            }
            else if (string.IsNullOrEmpty(txtRozaneSanadNumber.Text))
            {
                XtraMessageBox.Show("فیلد " + lblRozaneSanadNumber + " خالی است", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                txtRozaneSanadNumber.Focus();
                return false;
            }
            else if (string.IsNullOrEmpty(cmbNoeSanad.Text))
            {
                XtraMessageBox.Show("لطفاً " + lblNoeSanad.Text + " را مشخص کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                cmbNoeSanad.Focus();
                return false;
            }
            else if (string.IsNullOrEmpty(txtTarikhSanad.Text))
            {
                XtraMessageBox.Show("لطفاً تاریخ سند را وارد کنید", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                txtTarikhSanad.Focus();
                return false;
            }
            else if (gridView_AghlamKala.RowCount == 0 && _NoeFactor == 0)
            {
                XtraMessageBox.Show("در قسمت اقلام کالا اطلاعاتی برای ذخیره وجود ندارد", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                XtraTabControl1.SelectedTabPage = xtp_AghlamKala;
                btnInsert1.Focus();
                return false;
            }
            else if (gridView_AghlamKhadamat.RowCount == 0 && _NoeFactor == 1)
            {
                XtraMessageBox.Show("در قسمت اقلام خدمات اطلاعاتی برای ذخیره وجود ندارد", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                XtraTabControl1.SelectedTabPage = xtp_AghlamKhadamat;
                btnInsert1.Focus();
                return false;
            }
            return true;
        }

        private void btnSaveAndClosed_Click(object sender, EventArgs e)
        {
            if (btnSaveAndClosed.Enabled)
            {
                using (var db = new MyContext())
                {
                    try
                    {
                        if (IsValidation())
                        {
                            _SalId = Convert.ToInt32(lblSalId.Text);

                            DateTime? _DateTimePaygiri = null;
                            if (!string.IsNullOrEmpty(txtTarikhPaygiri.Text))
                                _DateTimePaygiri = Convert.ToDateTime(txtTarikhPaygiri.Text);
                            DateTime _DateTimeSanad = Convert.ToDateTime(txtTarikhSanad.Text);
                            DateTime _DateTimeInsert = DateTime.Now;
                            _NameSanadIndex = Convert.ToInt32(cmbNameSanad.SelectedIndex);
                            _NameSanadText = cmbNameSanad.Text;

                            _NoeSanadIndex = Convert.ToInt32(cmbNoeSanad.SelectedIndex);
                            _NoeSanadText = cmbNoeSanad.Text;
                            //_NoeSanadIndex_Khadamat = Convert.ToInt32(cmbNoeSanad_AghlamKhadamat.SelectedIndex);
                            //_NoeSanadText_Khadamat = cmbNoeSanad_AghlamKhadamat.Text;

                            int? _GhateySanadNamber = null;
                            int _SabetAtefNumber = 0;
                            int _RozaneSanadNumber = Convert.ToInt32(txtRozaneSanadNumber.Text);
                            int? _PaygiriNumber = null;
                            if (txtPaygiriNumber.Text != "")
                                _PaygiriNumber = Convert.ToInt32(txtPaygiriNumber.Text);
                            if (!string.IsNullOrEmpty(txtSharhSanad.Text))
                                _SharhSanad = txtSharhSanad.Text;

                            //_NoeAghlamText = cmbNoeAghlamKala.Text;
                            //_NoeAghlamIndex = Convert.ToInt32(cmbNoeAghlamKala.SelectedIndex);
                            //_FNumberCol_BaNameSanad_BeSelectAnbar = Convert.ToInt32(txtFNumberCol_BaNameSanad_BeSelectAnbar.Text);
                            //_FNumberJoze_BaNameSanad_BaSelectAnbar = Convert.ToInt32(txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text);

                            //_HesabMoinId_Bed = Convert.ToInt32(cmbHesabMoin.EditValue);
                            //_HesabTafsili1Id_Bed = Convert.ToInt32(cmbHesabTafsili1.EditValue) == 0 ? db.EpAllHesabTafsilis.FirstOrDefault(s => s.SalId == _SalId && s.LevelNumber == 1 && s.EpAllGroupTafsili1.TabaghehGroupIndex == 11 && s.Name == "سایر 1").Id : Convert.ToInt32(cmbHesabTafsili1.EditValue);
                            //_HesabTafsili2Id_Bed = Convert.ToInt32(cmbHesabTafsili2.EditValue) == 0 ? db.EpAllHesabTafsilis.FirstOrDefault(s => s.SalId == _SalId && s.LevelNumber == 2 && s.EpAllGroupTafsili1.TabaghehGroupIndex == 11 && s.Name == "سایر 2").Id : Convert.ToInt32(cmbHesabTafsili2.EditValue);
                            //_HesabTafsili3Id_Bed = Convert.ToInt32(cmbHesabTafsili3.EditValue) == 0 ? db.EpAllHesabTafsilis.FirstOrDefault(s => s.SalId == _SalId && s.LevelNumber == 3 && s.EpAllGroupTafsili1.TabaghehGroupIndex == 11 && s.Name == "سایر 3").Id : Convert.ToInt32(cmbHesabTafsili3.EditValue);


                            if (En1 == EnumCED.Create)
                            {
                                //var qq = db.EpNameKalas.Where(s => s.SalId == _SalId);
                                var qp1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                _FNumber_BeNameAmaliat_BeSelectAnbar = qp1.Select(s => s.FNumber_BeNameAmaliat_BeSelectAnbar).ToList().Count > 0 ? qp1.Max(s => s.FNumber_BeNameAmaliat_BeSelectAnbar) + 1 : 1;
                                //_FNumber_BaNameAmaliat_BeSelectAnbar = qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).Select(s => s.FNumber_BaNameAmaliat_BeSelectAnbar).ToList().Count > 0 ? qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).Max(s => s.FNumber_BaNameAmaliat_BeSelectAnbar) + 1 : 1;
                                _FNumberCol_BaNameSanad_BeSelectAnbar = qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode).Select(s => s.FNumberCol_BaNameSanad_BeSelectAnbar).ToList().Count > 0 ? qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode).Max(s => s.FNumberCol_BaNameSanad_BeSelectAnbar) + 1 : 1;
                                _FNumberJoze_BaNameSanad_BaNoeFactor = qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.NoeFactor == _NoeFactor).Select(s => s.FNumberJoze_BaNameSanad_BaNoeFactor).ToList().Count > 0 ? qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.NoeFactor == _NoeFactor).Max(s => s.FNumberJoze_BaNameSanad_BaNoeFactor) + 1 : 1;

                                //var qp3 = qp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).ToList();
                                //_SeryalCol_BaNameAmaliat_BeSelectAnbar = qp3.Count > 0 ? qp3.Max(s => s.SeryalCol_BaNameAmaliat_BeSelectAnbar) + 1 : 1;

                                //var qp4 = qp3.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                //_SeryalJoze_BaNameSanad_BeSelectAnbar = qp4.Count > 0 ? qp4.Max(s => s.SeryalJoze_BaNameSanad_BeSelectAnbar) + 1 : 1;


                                List<FkAmaliatFrooshVKharid_Riz> list = new List<FkAmaliatFrooshVKharid_Riz>();
                                ///////////////   اقلام کالا  /////////////**************************************************
                                if (gridView_AghlamKala.RowCount > 0 && _NoeFactor == 0)
                                {
                                    if (this.Name == "FrmFactorKharidKala" || this.Name == "FrmFactorFrooshKala")
                                        if (Convert.ToInt32(cmbSefaresh.EditValue) != 0) _SefareshId = Convert.ToInt32(cmbSefaresh.EditValue); else _SefareshId = null;
                                    else if (this.Name == "FrmFactorBargashtAzKharidKala" || this.Name == "FrmFactorBargashtAzFrooshKala")
                                        if (Convert.ToInt32(cmbSanadMabna.EditValue) != 0) _SanadMabnaId = Convert.ToInt32(cmbSanadMabna.EditValue); else _SanadMabnaId = null;
                                    else if (this.Name == "FrmSefareshKharidKala" || this.Name == "FrmSefareshFrooshKala")
                                    {
                                        _SefareshId = null;
                                        _SanadMabnaId = null;

                                    }

                                    if (_FirstSelectAnbar_NextSanad)
                                    {
                                        _AnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                                        var qp2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId).ToList();
                                        //_FNumber_BaNameAmaliat_BaSelectAnbar = qp2.Count > 0 ? qp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;
                                        _FNumberJoze_BaNameSanad_BaSelectAnbar = qp2.Where(s => s.NameSanadCode == _NameSanadCode).Select(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar).ToList().Count > 0 ? qp2.Where(s => s.NameSanadCode == _NameSanadCode).Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                    }

                                    for (int i = 0; i < gridView_AghlamKala.RowCount; i++)
                                    {
                                        //if (!_FirstSelectAnbar_NextSanad)
                                        //{
                                        //    _AnbarId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "AnbarId"));
                                        //    var qp2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId).ToList();
                                        //    _FNumber_BaNameAmaliat_BaSelectAnbar = qp2.Count > 0 ? qp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;
                                        //    _FNumberJoze_BaNameSanad_BaSelectAnbar = qp2.Where(s => s.NameSanadCode == _NameSanadCode).Select(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar).ToList().Count > 0 ? qp2.Where(s => s.NameSanadCode == _NameSanadCode).Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;

                                        //    //var qq1 = q.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                        //    //_SeryalJoze_BaNameSanad_BaSelectAnbar = qq1.Count > 0 ? qq1.Max(s => s.SeryalJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                        //}

                                        _AnbarId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "AnbarId"));
                                        _KalaId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "KalaId"));
                                        // _VahedeKalaId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "VahedeKalaId"));
                                        //long _Code = Convert.ToInt64(gridView_AmaliatAddVaEdit.GetRowCellValue(i, "KalaCode_NM"));
                                        _Meghdar = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Mablag"));
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_AghlamKala.GetRowCellDisplayText(i, "Tozihat")) ? gridView_AghlamKala.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                        obj1.SalId = _SalId;
                                        obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                        obj1.IndexAghlamFactor = 0;
                                        obj1.AnbarId = _AnbarId;
                                        obj1.KalaId = _KalaId;
                                        //obj1.VahedeKalaId = _VahedeKalaId;
                                        obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.GhateySanadNamber = _GhateySanadNamber;
                                        obj1.SabetAtefNumber = _SabetAtefNumber;
                                        obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                        obj1.PaygiriNumber = _PaygiriNumber;
                                        obj1.DateTimePaygiri = _DateTimePaygiri;
                                        obj1.DateTimeSanad = _DateTimeSanad;
                                        obj1.DateTimeInsert = _DateTimeInsert;
                                        obj1.NoeFactor = _NoeFactor;
                                        obj1.NameAmaliatCode = _NameAmaliatCode;
                                        obj1.NameSanadCode = _NameSanadCode;
                                        obj1.NameSanadText = _NameSanadText;
                                        obj1.NameSanadIndex = _NameSanadIndex;
                                        obj1.NoeSanadIndex = _NoeSanadIndex;
                                        obj1.NoeSanadText = _NoeSanadText;
                                        //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                        //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                        obj1.SefareshId = _SefareshId;
                                        obj1.SanadMabnaId = _SanadMabnaId;
                                        obj1.Meghdar = _Meghdar;
                                        obj1.Nerkh = _Nerkh;
                                        obj1.Mablag = _Mablag;
                                        obj1.Motefareghe = _Motefareghe;
                                        obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                        obj1.Maliat = _Maliat;
                                        obj1.Avarez = _Avarez;
                                        //obj1.IsRiali = _Mablag > 0 ? true : false;
                                        obj1.Radif = i + 1;
                                        obj1.Tozihat = _Tozihat;
                                        obj1.SharhSanad = _SharhSanad;
                                        obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                        obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                        obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                        obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                        obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                        obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                        obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                        obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;
                                        list.Add(obj1);

                                    }
                                }
                                /////////////// اقلام خدمات /////////////***************************************************
                                if (gridView_AghlamKhadamat.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    if (_NoeFactor == 1)
                                    {
                                        if (this.Name == "FrmFactorKharidKhadamat" || this.Name == "FrmFactorFrooshKhadamat")
                                            if (Convert.ToInt32(cmbSefaresh.EditValue) != 0) _SefareshId = Convert.ToInt32(cmbSefaresh.EditValue); else _SefareshId = null;
                                        else if (this.Name == "FrmFactorBargashtAzKharidKhadamat" || this.Name == "FrmFactorBargashtAzFrooshKhadamat")
                                            if (Convert.ToInt32(cmbSanadMabna.EditValue) != 0) _SanadMabnaId = Convert.ToInt32(cmbSanadMabna.EditValue); else _SanadMabnaId = null;
                                        else if (this.Name == "FrmSefareshKharidKhadamat" || this.Name == "FrmSefareshFrooshKhadamat")
                                        {
                                            _SefareshId = null;
                                            _SanadMabnaId = null;

                                        }
                                    }
                                    else
                                    {
                                        _SefareshId = null;
                                        _SanadMabnaId = null;
                                    }
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    //if (_NoeFactor == 0)
                                    //{
                                    //    _NoeSanadIndex_Kala = -1;
                                    //    _NoeSanadText_Kala = "";

                                    //}
                                    //else if (_NoeFactor == 1)
                                    //{
                                    //    _NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                    //    _NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    //}
                                    for (int i = 0; i < gridView_AghlamKhadamat.RowCount; i++)
                                    {
                                        _KalaId = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "KalaId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "VahedeKalaId"));
                                        _Meghdar = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Mablag"));
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_AghlamKhadamat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_AghlamKhadamat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                        obj1.SalId = _SalId;
                                        obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                        obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                        obj1.IndexAghlamFactor = 1;
                                        obj1.AnbarId = _AnbarId;
                                        obj1.KalaId = _KalaId;
                                        //obj1.VahedeKalaId = _VahedeKalaId;
                                        //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                        //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.GhateySanadNamber = _GhateySanadNamber;
                                        obj1.SabetAtefNumber = _SabetAtefNumber;
                                        obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                        obj1.PaygiriNumber = _PaygiriNumber;
                                        obj1.DateTimePaygiri = _DateTimePaygiri;
                                        obj1.DateTimeSanad = _DateTimeSanad;
                                        obj1.DateTimeInsert = _DateTimeInsert;
                                        obj1.NoeFactor = _NoeFactor;
                                        obj1.NameAmaliatCode = _NameAmaliatCode;
                                        obj1.NameSanadCode = _NameSanadCode;
                                        obj1.NameSanadText = _NameSanadText;
                                        obj1.NameSanadIndex = _NameSanadIndex;
                                        obj1.NoeSanadIndex = _NoeSanadIndex;
                                        obj1.NoeSanadText = _NoeSanadText;
                                        //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                        //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                        obj1.SefareshId = _SefareshId;
                                        obj1.SanadMabnaId = _SanadMabnaId;
                                        obj1.Meghdar = _Meghdar;
                                        obj1.Nerkh = _Nerkh;
                                        obj1.Mablag = _Mablag;
                                        obj1.Motefareghe = _Motefareghe;
                                        obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                        obj1.Maliat = _Maliat;
                                        obj1.Avarez = _Avarez;
                                        //obj1.IsRiali = _Mablag > 0 ? true : false;
                                        obj1.Radif = i + 1;
                                        obj1.Tozihat = _Tozihat;
                                        obj1.SharhSanad = _SharhSanad;
                                        obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                        obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                        obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                        obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                        obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                        obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                        obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                        obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;
                                        list.Add(obj1);

                                    }
                                }
                                /////////////// اضافات فاکتور //////////////
                                if (gridView_Ezafat.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    _KalaId = null;
                                    _SanadMabnaId = null;
                                    _SefareshId = null;
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    //if (_NoeFactor == 0)
                                    //{
                                    //    _NoeSanadIndex_Kala = -1;
                                    //    _NoeSanadText_Kala = "";

                                    //}
                                    //else if (_NoeFactor == 1)
                                    //{
                                    //    _NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                    //    _NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    //}
                                    for (int i = 0; i < gridView_Ezafat.RowCount; i++)
                                    {
                                        _Ez_KsId = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "Ez_KsId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "VahedeKalaId"));
                                        _Meghdar = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Ezafat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Ezafat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                        obj1.SalId = _SalId;
                                        obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                        obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                        obj1.IndexAghlamFactor = 2;
                                        //obj1.AnbarId = _AnbarId;
                                        //obj1.KalaId = _KalaId;
                                        obj1.Ez_KsId = _Ez_KsId;
                                        //obj1.VahedeKalaId = _VahedeKalaId;
                                        //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                        //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.GhateySanadNamber = _GhateySanadNamber;
                                        obj1.SabetAtefNumber = _SabetAtefNumber;
                                        obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                        obj1.PaygiriNumber = _PaygiriNumber;
                                        obj1.DateTimePaygiri = _DateTimePaygiri;
                                        obj1.DateTimeSanad = _DateTimeSanad;
                                        obj1.DateTimeInsert = _DateTimeInsert;
                                        obj1.NoeFactor = _NoeFactor;
                                        obj1.NameAmaliatCode = _NameAmaliatCode;
                                        obj1.NameSanadCode = _NameSanadCode;
                                        obj1.NameSanadText = _NameSanadText;
                                        obj1.NameSanadIndex = _NameSanadIndex;
                                        obj1.NoeSanadIndex = _NoeSanadIndex;
                                        obj1.NoeSanadText = _NoeSanadText;
                                        //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                        //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                        //obj1.SefareshId = _SefareshId;
                                        //obj1.SanadMabnaId = _SanadMabnaId;
                                        obj1.Meghdar = _Meghdar;
                                        obj1.Nerkh = _Nerkh;
                                        obj1.Mablag = _Mablag;
                                        //obj1.Motefareghe = _Motefareghe;
                                        //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                        //obj1.Maliat = _Maliat;
                                        //obj1.Avarez = _Avarez;
                                        //obj1.IsRiali = _Mablag > 0 ? true : false;
                                        obj1.Radif = i + 1;
                                        obj1.Tozihat = _Tozihat;
                                        obj1.SharhSanad = _SharhSanad;
                                        obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                        obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                        obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                        obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                        obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                        obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                        obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                        obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;
                                        list.Add(obj1);

                                    }
                                }
                                /////////////// کسورات فاکتور //////////////
                                if (gridView_Ksorat.RowCount > 0)
                                {
                                    _KalaId = null;
                                    _AnbarId = null;
                                    _SanadMabnaId = null;
                                    _SefareshId = null;
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    //if (_NoeFactor == 0)
                                    //{
                                    //    _NoeSanadIndex_Kala = -1;
                                    //    _NoeSanadText_Kala = "";

                                    //}
                                    //else if (_NoeFactor == 1)
                                    //{
                                    //    _NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                    //    _NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    //}
                                    for (int i = 0; i < gridView_Ksorat.RowCount; i++)
                                    {
                                        _Ez_KsId = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "Ez_KsId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "VahedeKalaId"));
                                        _Meghdar = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Ksorat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Ksorat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                        obj1.SalId = _SalId;
                                        obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                        obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                        obj1.IndexAghlamFactor = 3;
                                        //obj1.AnbarId = _AnbarId;
                                        //obj1.KalaId = _KalaId;
                                        obj1.Ez_KsId = _Ez_KsId;
                                        //obj1.VahedeKalaId = _VahedeKalaId;
                                        //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                        //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.GhateySanadNamber = _GhateySanadNamber;
                                        obj1.SabetAtefNumber = _SabetAtefNumber;
                                        obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                        obj1.PaygiriNumber = _PaygiriNumber;
                                        obj1.DateTimePaygiri = _DateTimePaygiri;
                                        obj1.DateTimeSanad = _DateTimeSanad;
                                        obj1.DateTimeInsert = _DateTimeInsert;
                                        obj1.NoeFactor = _NoeFactor;
                                        obj1.NameAmaliatCode = _NameAmaliatCode;
                                        obj1.NameSanadCode = _NameSanadCode;
                                        obj1.NameSanadText = _NameSanadText;
                                        obj1.NameSanadIndex = _NameSanadIndex;
                                        obj1.NoeSanadIndex = _NoeSanadIndex;
                                        obj1.NoeSanadText = _NoeSanadText;
                                        //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                        //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                        //obj1.SefareshId = _SefareshId;
                                        //obj1.SanadMabnaId = _SanadMabnaId;
                                        obj1.Meghdar = _Meghdar;
                                        obj1.Nerkh = _Nerkh;
                                        obj1.Mablag = _Mablag;
                                        //obj1.Motefareghe = _Motefareghe;
                                        //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                        //obj1.Maliat = _Maliat;
                                        //obj1.Avarez = _Avarez;
                                        //obj1.IsRiali = _Mablag > 0 ? true : false;
                                        obj1.Radif = i + 1;
                                        obj1.Tozihat = _Tozihat;
                                        obj1.SharhSanad = _SharhSanad;
                                        obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                        obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                        obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                        obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                        obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                        obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                        obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                        obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;
                                        list.Add(obj1);

                                    }
                                }
                                /////////////// ویزیتور فاکتور //////////////
                                if (gridView_Vizitor.RowCount > 0)
                                {
                                    _Ez_KsId = null;
                                    _AnbarId = null;
                                    _KalaId = null;
                                    //_VahedeKalaId = null;
                                    _SanadMabnaId = null;
                                    _SefareshId = null;

                                    for (int i = 0; i < gridView_Vizitor.RowCount; i++)
                                    {
                                        _VizitorId = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "VizitorId"));
                                        _Meghdar = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Vizitor.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Vizitor.GetRowCellDisplayText(i, "Tozihat").ToString() : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                        obj1.SalId = _SalId;
                                        obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                        obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                        obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                        obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                        obj1.IndexAghlamFactor = 4;
                                        obj1.VizitorId = _VizitorId;
                                        //obj1.AnbarId = _AnbarId;
                                        //obj1.KalaId = _KalaId;
                                        //obj1.VahedeKalaId = _VahedeKalaId;
                                        //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                        //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                        //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                        //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                        obj1.GhateySanadNamber = _GhateySanadNamber;
                                        obj1.SabetAtefNumber = _SabetAtefNumber;
                                        obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                        obj1.PaygiriNumber = _PaygiriNumber;
                                        obj1.DateTimePaygiri = _DateTimePaygiri;
                                        obj1.DateTimeSanad = _DateTimeSanad;
                                        obj1.DateTimeInsert = _DateTimeInsert;
                                        obj1.NoeFactor = _NoeFactor;
                                        obj1.NameAmaliatCode = _NameAmaliatCode;
                                        obj1.NameSanadCode = _NameSanadCode;
                                        obj1.NameSanadText = _NameSanadText;
                                        obj1.NameSanadIndex = _NameSanadIndex;
                                        obj1.NoeSanadIndex = _NoeSanadIndex;
                                        obj1.NoeSanadText = _NoeSanadText;
                                        //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                        //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                        //obj1.SefareshId = _SefareshId;
                                        //obj1.SanadMabnaId = _SanadMabnaId;
                                        obj1.Meghdar = _Meghdar;
                                        obj1.Nerkh = _Nerkh;
                                        obj1.Mablag = _Mablag;
                                        //obj1.Motefareghe = _Motefareghe;
                                        //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                        //obj1.Maliat = _Maliat;
                                        //obj1.Avarez = _Avarez;
                                        //obj1.IsRiali = _Mablag > 0 ? true : false;
                                        obj1.Radif = i + 1;
                                        obj1.Tozihat = _Tozihat;
                                        obj1.SharhSanad = _SharhSanad;
                                        obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                        obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                        obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                        obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                        obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                        obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                        obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                        obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;
                                        list.Add(obj1);

                                    }
                                }


                                db.FkAmaliatFrooshVKharid_Rizs.AddRange(list);
                                db.SaveChanges();
                                En1 = EnumCED.Save;
                                if (sender == btnSaveAndClosed || sender == null)
                                    this.Close();
                                else if (sender == btnSaveAndNext)
                                    NewAction();


                            }
                            else if (En1 == EnumCED.Edit)
                            {
                                _SalId = Convert.ToInt32(lblSalId.Text);
                                DateTime _DateTimeEdit = DateTime.Now;
                                List<FkAmaliatFrooshVKharid_Riz> RemoveList = new List<FkAmaliatFrooshVKharid_Riz>();
                                List<FkAmaliatFrooshVKharid_Riz> EditList = new List<FkAmaliatFrooshVKharid_Riz>();
                                List<FkAmaliatFrooshVKharid_Riz> AddList = new List<FkAmaliatFrooshVKharid_Riz>();

                                ///////////////   اقلام کالا  /////////////////////////////////////////**********************
                                if (_NoeFactor == 0)
                                {
                                    if (this.Name == "FrmFactorKharidKala" || this.Name == "FrmFactorFrooshKala")
                                        if (Convert.ToInt32(cmbSefaresh.EditValue) != 0) _SefareshId = Convert.ToInt32(cmbSefaresh.EditValue); else _SefareshId = null;
                                    else if (this.Name == "FrmFactorBargashtAzKharidKala" || this.Name == "FrmFactorBargashtAzFrooshKala")
                                        if (Convert.ToInt32(cmbSanadMabna.EditValue) != 0) _SanadMabnaId = Convert.ToInt32(cmbSanadMabna.EditValue); else _SanadMabnaId = null;
                                    else if (this.Name == "FrmSefareshKharidKala" || this.Name == "FrmSefareshFrooshKala")
                                    {
                                        _SefareshId = null;
                                        _SanadMabnaId = null;
                                    }

                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = (List<FkAmaliatFrooshVKharid_Riz>)fkAmaliatFrooshVKharid_RizsBindingSource_Kala.DataSource;
                                    //BindingList<FkAmaliatFrooshVKharid_Riz> list = new BindingList<FkAmaliatFrooshVKharid_Riz>(DBGridControl);
                                    List<FkAmaliatFrooshVKharid_Riz> list_Kala = ((IEnumerable)gridView_AghlamKala.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();

                                    List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();
                                    if (_FirstSelectAnbar_NextSanad)
                                    {
                                        _AnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                                        var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 0 && s.AnbarId == _AnbarId && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                        && s.FNumberJoze_BaNameSanad_BaSelectAnbar == _FNumberJoze_BaNameSanad_BaSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                        foreach (var item in qq2)
                                        {
                                            if (!list_Kala.Any(s => s.Id == item.Id))
                                            {
                                                var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                                RemoveList.Add(pp);
                                                //qq2.Remove(pp);
                                                //db.FkAmaliatFrooshVKharid_Rizs.Remove(qq2.FirstOrDefault(s => s.Id == item.Id));
                                                //db.SaveChanges();
                                            }
                                            else
                                            {
                                                var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                                q2.Add(pp);

                                            }
                                        }
                                        //q2 = qq2 ;
                                    }
                                    else
                                    {
                                        var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 0 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                        && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                        foreach (var item in qq2)
                                        {
                                            if (!list_Kala.Any(s => s.Id == item.Id))
                                            {
                                                var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                                RemoveList.Add(pp);
                                                //qq2.Remove(pp);
                                                //db.FkAmaliatFrooshVKharid_Rizs.Remove(qq2.FirstOrDefault(s => s.Id == item.Id));
                                                //db.SaveChanges();
                                            }
                                            else
                                            {
                                                var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                                q2.Add(pp);

                                            }
                                        }
                                        //q2 = qq2;
                                    }


                                    //var q = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                    for (int i = 0; i < list_Kala.Count; i++)
                                    {
                                        //if (!_FirstSelectAnbar_NextSanad)
                                        //{
                                        //    _AnbarId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "AnbarId"));

                                        //    var pp1 = q.Where(s => s.AnbarId == _AnbarId).ToList();
                                        //    //var ss1 = q2.FirstOrDefault(s => s.BeAnbarId == _BeAnbarId);
                                        //    //_SeryalCol_BeNameAmaliat_BaSelectAnbar = ss1 != null ? ss1.SeryalCol_BeNameAmaliat_BaSelectAnbar : pp1.Count > 0 ? pp1.Max(s => s.SeryalCol_BeNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp2 = pp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).ToList();
                                        //    var ss2 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId);
                                        //    _FNumber_BaNameAmaliat_BaSelectAnbar = ss2 != null ? ss2.FNumber_BaNameAmaliat_BaSelectAnbar : pp2.Count > 0 ? pp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp3 = pp2.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                        //    var ss3 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.AnbarId == _AnbarId);
                                        //    _FNumberJoze_BaNameSanad_BaSelectAnbar = ss3 != null ? ss3.FNumberJoze_BaNameSanad_BaSelectAnbar : pp3.Count > 0 ? pp3.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                        //}

                                        _AnbarId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "AnbarId"));
                                        _KalaId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "KalaId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "VahedeKalaId"));
                                        //long _Code = Convert.ToInt64(gridView_AmaliatAddVaEdit.GetRowCellValue(i, "KalaCode_NM"));
                                        _Meghdar = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Mablag"));
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        if (Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_AghlamKala.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_AghlamKala.GetRowCellDisplayText(i, "Tozihat")) ? gridView_AghlamKala.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_AghlamKala.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        if (list_Kala[i].Id > 0)
                                        {

                                            var v1 = q2.FirstOrDefault(s => s.Id == list_Kala[i].Id);

                                            //v1.SalId = _SalId;
                                            //v1.AnbarId = _AnbarId;
                                            //v1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            v1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            //v1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            v1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            v1.RozaneSanadNumber = _RozaneSanadNumber;
                                            v1.PaygiriNumber = _PaygiriNumber;
                                            //v1.IndexAghlamFactor = 0;
                                            v1.AnbarId = _AnbarId;
                                            v1.KalaId = _KalaId;
                                            //v1.VahedeKalaId = _VahedeKalaId;
                                            v1.DateTimePaygiri = _DateTimePaygiri;
                                            v1.DateTimeSanad = _DateTimeSanad;
                                            v1.DateTimeEdit = _DateTimeEdit;
                                            //v1.NameAmaliatCode = _NameAmaliatCode;
                                            //v1.NameSanadCode = _NameSanadCode;
                                            //v1.NameSanadText = _NameSanadText;
                                            //v1.NameSanadIndex = _NameSanadIndex;
                                            v1.NoeSanadIndex = _NoeSanadIndex;
                                            v1.NoeSanadText = _NoeSanadText;
                                            //v1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //v1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            v1.SefareshId = _SefareshId;
                                            v1.SanadMabnaId = _SanadMabnaId;
                                            v1.Meghdar = _Meghdar;
                                            v1.Nerkh = _Nerkh;
                                            v1.Mablag = _Mablag;
                                            v1.Motefareghe = _Motefareghe;
                                            v1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            v1.Maliat = _Maliat;
                                            v1.Avarez = _Avarez;
                                            //v1.IsRiali = _Mablag > 0 ? true : false;
                                            v1.Tozihat = _Tozihat;
                                            v1.SharhSanad = _SharhSanad;
                                            v1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            v1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            v1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            v1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            v1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            v1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            v1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            v1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            EditList.Add(v1);
                                            //db.SaveChanges();

                                        }
                                        else
                                        {

                                            FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                            obj1.SalId = _SalId;
                                            obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                            obj1.NoeFactor = _NoeFactor;
                                            obj1.IndexAghlamFactor = 0;
                                            obj1.AnbarId = _AnbarId;
                                            obj1.KalaId = _KalaId;
                                            //obj1.VahedeKalaId = _VahedeKalaId;
                                            obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.GhateySanadNamber = _GhateySanadNamber;
                                            obj1.SabetAtefNumber = _SabetAtefNumber;
                                            obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.DateTimePaygiri = _DateTimePaygiri;
                                            obj1.DateTimeSanad = _DateTimeSanad;
                                            obj1.DateTimeInsert = _DateTimeInsert;
                                            obj1.NameAmaliatCode = _NameAmaliatCode;
                                            obj1.NameSanadCode = _NameSanadCode;
                                            obj1.NameSanadText = _NameSanadText;
                                            obj1.NameSanadIndex = _NameSanadIndex;
                                            obj1.NoeSanadIndex = _NoeSanadIndex;
                                            obj1.NoeSanadText = _NoeSanadText;
                                            //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            obj1.SefareshId = _SefareshId;
                                            obj1.SanadMabnaId = _SanadMabnaId;
                                            obj1.Meghdar = _Meghdar;
                                            obj1.Nerkh = _Nerkh;
                                            obj1.Mablag = _Mablag;
                                            obj1.Motefareghe = _Motefareghe;
                                            obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            obj1.Maliat = _Maliat;
                                            obj1.Avarez = _Avarez;
                                            //obj1.IsRiali = _Mablag > 0 ? true : false;
                                            obj1.Radif = i + 1;
                                            obj1.Tozihat = _Tozihat;
                                            obj1.SharhSanad = _SharhSanad;
                                            //if (!string.IsNullOrEmpty(cmbSefaresh.Text))
                                            //obj1.SefareshId = Convert.ToInt32(cmbSefaresh.EditValue);
                                            //obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            //obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            AddList.Add(obj1);
                                            //db.FkAmaliatFrooshVKharid_Rizs.Add(obj1);
                                            //db.SaveChanges();
                                        }
                                    }


                                    //var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.AnbarId != null && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    //&& s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();

                                    //if (qq1.Count > 0)
                                    //{
                                    //    for (int j = 0; j < qq1.Count; j++)
                                    //    {
                                    //        qq1[j].Radif = j + 1;
                                    //    }
                                    //    db.SaveChanges();
                                    //}

                                }
                                /////////////// اقلام خدمات //////////////////////////////////////////**********************
                                //if (gridView_AghlamKhadamat.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    if (_NoeFactor == 1)
                                    {
                                        if (this.Name == "FrmFactorKharidKhadamat" || this.Name == "FrmFactorFrooshKhadamat")
                                            if (Convert.ToInt32(cmbSefaresh.EditValue) != 0) _SefareshId = Convert.ToInt32(cmbSefaresh.EditValue); else _SefareshId = null;
                                        else if (this.Name == "FrmFactorBargashtAzKharidKhadamat" || this.Name == "FrmFactorBargashtAzFrooshKhadamat")
                                            if (Convert.ToInt32(cmbSanadMabna.EditValue) != 0) _SanadMabnaId = Convert.ToInt32(cmbSanadMabna.EditValue); else _SanadMabnaId = null;
                                        else if (this.Name == "FrmSefareshKharidKhadamat" || this.Name == "FrmSefareshFrooshKhadamat")
                                        {
                                            _SefareshId = null;
                                            _SanadMabnaId = null;

                                        }

                                    }
                                    else if (_NoeFactor == 0)
                                    {
                                        _SefareshId = null;
                                        _SanadMabnaId = null;
                                        //_NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                        //_NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    }

                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = (List<FkAmaliatFrooshVKharid_Riz>)fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.DataSource;
                                    //BindingList<FkAmaliatFrooshVKharid_Riz> list = new BindingList<FkAmaliatFrooshVKharid_Riz>(DBGridControl);

                                    List<FkAmaliatFrooshVKharid_Riz> list_Khadamat = ((IEnumerable)gridView_AghlamKhadamat.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();
                                    //var List = (fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.l
                                    List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();

                                    var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 1 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    foreach (var item in qq2)
                                    {
                                        if (!list_Khadamat.Any(s => s.Id == item.Id))
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            RemoveList.Add(pp);
                                        }
                                        else
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            q2.Add(pp);

                                        }

                                    }


                                    //var q = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                    for (int i = 0; i < list_Khadamat.Count; i++)
                                    {
                                        //if (!_FirstSelectAnbar_NextSanad)
                                        //{
                                        //    _AnbarId = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "AnbarId"));

                                        //    var pp1 = q.Where(s => s.AnbarId == _AnbarId).ToList();
                                        //    //var ss1 = q2.FirstOrDefault(s => s.BeAnbarId == _BeAnbarId);
                                        //    //_SeryalCol_BeNameAmaliat_BaSelectAnbar = ss1 != null ? ss1.SeryalCol_BeNameAmaliat_BaSelectAnbar : pp1.Count > 0 ? pp1.Max(s => s.SeryalCol_BeNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp2 = pp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).ToList();
                                        //    var ss2 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId);
                                        //    _FNumber_BaNameAmaliat_BaSelectAnbar = ss2 != null ? ss2.FNumber_BaNameAmaliat_BaSelectAnbar : pp2.Count > 0 ? pp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp3 = pp2.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                        //    var ss3 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.AnbarId == _AnbarId);
                                        //    _FNumberJoze_BaNameSanad_BaSelectAnbar = ss3 != null ? ss3.FNumberJoze_BaNameSanad_BaSelectAnbar : pp3.Count > 0 ? pp3.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                        //}

                                        _KalaId = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "KalaId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "VahedeKalaId"));
                                        //long _Code = Convert.ToInt64(gridView_AmaliatAddVaEdit.GetRowCellValue(i, "KalaCode_NM"));
                                        _Meghdar = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Mablag"));
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        if (Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_AghlamKhadamat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_AghlamKhadamat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_AghlamKhadamat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_AghlamKhadamat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        if (list_Khadamat[i].Id > 0)
                                        {

                                            var v1 = q2.FirstOrDefault(s => s.Id == list_Khadamat[i].Id);

                                            //v1.SalId = _SalId;
                                            //v1.AnbarId = _AnbarId;
                                            //v1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            //v1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            v1.RozaneSanadNumber = _RozaneSanadNumber;
                                            v1.PaygiriNumber = _PaygiriNumber;
                                            v1.KalaId = _KalaId;
                                            //v1.VahedeKalaId = _VahedeKalaId;
                                            v1.DateTimePaygiri = _DateTimePaygiri;
                                            v1.DateTimeSanad = _DateTimeSanad;
                                            v1.DateTimeEdit = _DateTimeEdit;
                                            //v1.NameAmaliatCode = _NameAmaliatCode;
                                            //v1.NameSanadCode = _NameSanadCode;
                                            //v1.NameSanadText = _NameSanadText;
                                            //v1.NameSanadIndex = _NameSanadIndex;
                                            v1.NoeSanadIndex = _NoeSanadIndex;
                                            v1.NoeSanadText = _NoeSanadText;
                                            //v1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //v1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            v1.SefareshId = _SefareshId;
                                            v1.SanadMabnaId = _SanadMabnaId;
                                            v1.Meghdar = _Meghdar;
                                            v1.Nerkh = _Nerkh;
                                            v1.Mablag = _Mablag;
                                            v1.Motefareghe = _Motefareghe;
                                            v1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            v1.Maliat = _Maliat;
                                            v1.Avarez = _Avarez;
                                            //v1.IsRiali = _Mablag > 0 ? true : false;
                                            v1.Tozihat = _Tozihat;
                                            v1.SharhSanad = _SharhSanad;
                                            v1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            v1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            v1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            v1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            v1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            v1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            v1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            v1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            EditList.Add(v1);
                                        }
                                        else
                                        {

                                            FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                            obj1.SalId = _SalId;
                                            obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                            obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                            obj1.NoeFactor = _NoeFactor;
                                            obj1.IndexAghlamFactor = 1;
                                            //obj1.AnbarId = _AnbarId;
                                            obj1.KalaId = _KalaId;
                                            //obj1.VahedeKalaId = _VahedeKalaId;
                                            //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.GhateySanadNamber = _GhateySanadNamber;
                                            obj1.SabetAtefNumber = _SabetAtefNumber;
                                            obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.DateTimePaygiri = _DateTimePaygiri;
                                            obj1.DateTimeSanad = _DateTimeSanad;
                                            obj1.DateTimeInsert = _DateTimeInsert;
                                            obj1.NameAmaliatCode = _NameAmaliatCode;
                                            obj1.NameSanadCode = _NameSanadCode;
                                            obj1.NameSanadText = _NameSanadText;
                                            obj1.NameSanadIndex = _NameSanadIndex;
                                            obj1.NoeSanadIndex = _NoeSanadIndex;
                                            obj1.NoeSanadText = _NoeSanadText;
                                            //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            obj1.SefareshId = _SefareshId;
                                            obj1.SanadMabnaId = _SanadMabnaId;
                                            obj1.Meghdar = _Meghdar;
                                            obj1.Nerkh = _Nerkh;
                                            obj1.Mablag = _Mablag;
                                            obj1.Motefareghe = _Motefareghe;
                                            obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            obj1.Maliat = _Maliat;
                                            obj1.Avarez = _Avarez;
                                            //obj1.IsRiali = _Mablag > 0 ? true : false;
                                            obj1.Radif = i + 1;
                                            obj1.Tozihat = _Tozihat;
                                            obj1.SharhSanad = _SharhSanad;
                                            //if (!string.IsNullOrEmpty(cmbSefaresh.Text))
                                            //obj1.SefareshId = Convert.ToInt32(cmbSefaresh.EditValue);
                                            //obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            //obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            AddList.Add(obj1);
                                        }
                                    }
                                    //var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.AnbarId == null && s.EpNameKala1.EpGroupFareeKala1.EpGroupAsliKala1.EpTabaghehKala1.NoeTabagheIndex == 1 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    //&& s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    //if (qq1.Count > 0)
                                    //{
                                    //    for (int j = 0; j < qq1.Count; j++)
                                    //    {
                                    //        qq1[j].Radif = j + 1;
                                    //    }
                                    //    db.SaveChanges();
                                    //}

                                }
                                ////////////// اضافات فاکتور///////////
                                //if (gridView_Ezafat.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    _SefareshId = null;
                                    _SanadMabnaId = null;
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    //if (_NoeFactor == 0)
                                    //{
                                    //    _NoeSanadIndex_Kala = -1;
                                    //    _NoeSanadText_Kala = "";

                                    //}
                                    //else if (_NoeFactor == 1)
                                    //{
                                    //    _NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                    //    _NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    //}

                                    //var Result = gridView_Ezafat.DataSource;
                                    //List<FkAmaliatFrooshVKharid_Riz> list = ((IEnumerable)fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();
                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = (List<FkAmaliatFrooshVKharid_Riz>)gridView_Ezafat.DataSource;
                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = new List<FkAmaliatFrooshVKharid_Riz>();
                                    //DBGridControl = (List<FkAmaliatFrooshVKharid_Riz>)fkAmaliatFrooshVKharid_RizsBindingSource_Ezafat.DataSource;
                                    //List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();
                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = new List<FkAmaliatFrooshVKharid_Riz>();
                                    //BindingList<FkAmaliatFrooshVKharid_Riz> list  = new BindingList<FkAmaliatFrooshVKharid_Riz>(DBGridControl);
                                    //try
                                    //{
                                    //    DBGridControl = gridControl_Ezafat.DataSource as List<FkAmaliatFrooshVKharid_Riz>;

                                    //}
                                    //catch (Exception)
                                    //{
                                    //}

                                    //try
                                    //{
                                    //    list = new BindingList<FkAmaliatFrooshVKharid_Riz>(DBGridControl);

                                    //}
                                    //catch (Exception)
                                    //{
                                    //}

                                    List<FkAmaliatFrooshVKharid_Riz> list_Ezafat = ((IEnumerable)gridView_Ezafat.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();

                                    List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();
                                    var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 2 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    foreach (var item in qq2)
                                    {
                                        if (!list_Ezafat.Any(s => s.Id == item.Id))
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            RemoveList.Add(pp);
                                        }
                                        else
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            q2.Add(pp);

                                        }
                                    }


                                    //var q = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                    for (int i = 0; i < list_Ezafat.Count; i++)
                                    {
                                        //if (!_FirstSelectAnbar_NextSanad)
                                        //{
                                        //    _AnbarId = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "AnbarId"));

                                        //    var pp1 = q.Where(s => s.AnbarId == _AnbarId).ToList();
                                        //    //var ss1 = q2.FirstOrDefault(s => s.BeAnbarId == _BeAnbarId);
                                        //    //_SeryalCol_BeNameAmaliat_BaSelectAnbar = ss1 != null ? ss1.SeryalCol_BeNameAmaliat_BaSelectAnbar : pp1.Count > 0 ? pp1.Max(s => s.SeryalCol_BeNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp2 = pp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).ToList();
                                        //    var ss2 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId);
                                        //    _FNumber_BaNameAmaliat_BaSelectAnbar = ss2 != null ? ss2.FNumber_BaNameAmaliat_BaSelectAnbar : pp2.Count > 0 ? pp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp3 = pp2.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                        //    var ss3 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.AnbarId == _AnbarId);
                                        //    _FNumberJoze_BaNameSanad_BaSelectAnbar = ss3 != null ? ss3.FNumberJoze_BaNameSanad_BaSelectAnbar : pp3.Count > 0 ? pp3.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                        //}

                                        _Ez_KsId = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "Ez_KsId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "VahedeKalaId"));
                                        //long _Code = Convert.ToInt64(gridView_AmaliatAddVaEdit.GetRowCellValue(i, "KalaCode_NM"));
                                        _Meghdar = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Ezafat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Ezafat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Ezafat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Ezafat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        if (list_Ezafat[i].Id > 0)
                                        {

                                            var v1 = q2.FirstOrDefault(s => s.Id == list_Ezafat[i].Id);

                                            //v1.SalId = _SalId;
                                            //v1.AnbarId = _AnbarId;
                                            //v1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            //v1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            v1.RozaneSanadNumber = _RozaneSanadNumber;
                                            v1.PaygiriNumber = _PaygiriNumber;
                                            v1.Ez_KsId = _Ez_KsId;
                                            //v1.VahedeKalaId = _VahedeKalaId;
                                            v1.DateTimePaygiri = _DateTimePaygiri;
                                            v1.DateTimeSanad = _DateTimeSanad;
                                            v1.DateTimeEdit = _DateTimeEdit;
                                            //v1.NameAmaliatCode = _NameAmaliatCode;
                                            //v1.NameSanadCode = _NameSanadCode;
                                            //v1.NameSanadText = _NameSanadText;
                                            //v1.NameSanadIndex = _NameSanadIndex;
                                            v1.NoeSanadIndex = _NoeSanadIndex;
                                            v1.NoeSanadText = _NoeSanadText;
                                            //v1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //v1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            v1.SefareshId = _SefareshId;
                                            v1.SanadMabnaId = _SanadMabnaId;
                                            v1.Meghdar = _Meghdar;
                                            v1.Nerkh = _Nerkh;
                                            v1.Mablag = _Mablag;
                                            //v1.Motefareghe = _Motefareghe;
                                            //v1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //v1.Maliat = _Maliat;
                                            //v1.Avarez = _Avarez;
                                            //v1.IsRiali = _Mablag > 0 ? true : false;
                                            v1.Tozihat = _Tozihat;
                                            v1.SharhSanad = _SharhSanad;
                                            v1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            v1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            v1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            v1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            v1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            v1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            v1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            v1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            EditList.Add(v1);
                                        }
                                        else
                                        {

                                            FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                            obj1.SalId = _SalId;
                                            obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                            obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                            obj1.NoeFactor = _NoeFactor;
                                            obj1.IndexAghlamFactor = 2;
                                            //obj1.AnbarId = _AnbarId;
                                            obj1.Ez_KsId = _Ez_KsId;
                                            //obj1.VahedeKalaId = _VahedeKalaId;
                                            //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.GhateySanadNamber = _GhateySanadNamber;
                                            obj1.SabetAtefNumber = _SabetAtefNumber;
                                            obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.DateTimePaygiri = _DateTimePaygiri;
                                            obj1.DateTimeSanad = _DateTimeSanad;
                                            obj1.DateTimeInsert = _DateTimeInsert;
                                            obj1.NameAmaliatCode = _NameAmaliatCode;
                                            obj1.NameSanadCode = _NameSanadCode;
                                            obj1.NameSanadText = _NameSanadText;
                                            obj1.NameSanadIndex = _NameSanadIndex;
                                            obj1.NoeSanadIndex = _NoeSanadIndex;
                                            obj1.NoeSanadText = _NoeSanadText;
                                            //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            obj1.SefareshId = _SefareshId;
                                            obj1.SanadMabnaId = _SanadMabnaId;
                                            obj1.Meghdar = _Meghdar;
                                            obj1.Nerkh = _Nerkh;
                                            obj1.Mablag = _Mablag;
                                            //obj1.Motefareghe = _Motefareghe;
                                            //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //obj1.Maliat = _Maliat;
                                            //obj1.Avarez = _Avarez;
                                            //obj1.IsRiali = _Mablag > 0 ? true : false;
                                            obj1.Radif = i + 1;
                                            obj1.Tozihat = _Tozihat;
                                            obj1.SharhSanad = _SharhSanad;
                                            //if (!string.IsNullOrEmpty(cmbSefaresh.Text))
                                            //obj1.SefareshId = Convert.ToInt32(cmbSefaresh.EditValue);
                                            //obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            //obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            AddList.Add(obj1);
                                        }
                                    }
                                    //var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.AnbarId == null && s.EpNameKala1.EpGroupFareeKala1.EpGroupAsliKala1.EpTabaghehKala1.NoeTabagheIndex == 2 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    //&& s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    //if (qq1.Count > 0)
                                    //{
                                    //    for (int j = 0; j < qq1.Count; j++)
                                    //    {
                                    //        qq1[j].Radif = j + 1;
                                    //    }
                                    //    db.SaveChanges();
                                    //}

                                }
                                ////////////// کسورات فاکتور///////////
                                //if (gridView_Ksorat.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    _SefareshId = null;
                                    _SanadMabnaId = null;
                                    //_FNumber_BaNameAmaliat_BaSelectAnbar = 0;
                                    //_FNumberJoze_BaNameSanad_BaSelectAnbar = 0;

                                    //if (_NoeFactor == 0)
                                    //{
                                    //    _NoeSanadIndex_Kala = -1;
                                    //    _NoeSanadText_Kala = "";

                                    //}
                                    //else if (_NoeFactor == 1)
                                    //{
                                    //    _NoeSanadIndex_Kala = Convert.ToInt32(cmbNoeSanad_AghlamKala.SelectedIndex);
                                    //    _NoeSanadText_Kala = cmbNoeSanad_AghlamKala.Text;

                                    //}

                                    //List<FkAmaliatFrooshVKharid_Riz> DBGridControl = (List<FkAmaliatFrooshVKharid_Riz>)fkAmaliatFrooshVKharid_RizsBindingSource_Ksorat.DataSource;
                                    //BindingList<FkAmaliatFrooshVKharid_Riz> list = new BindingList<FkAmaliatFrooshVKharid_Riz>(DBGridControl);

                                    List<FkAmaliatFrooshVKharid_Riz> list_Ksorat = ((IEnumerable)gridView_Ksorat.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();

                                    List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();
                                    var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 3 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    foreach (var item in qq2)
                                    {
                                        if (!list_Ksorat.Any(s => s.Id == item.Id))
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            RemoveList.Add(pp);
                                        }
                                        else
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            q2.Add(pp);

                                        }
                                    }


                                    //var q = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                    for (int i = 0; i < list_Ksorat.Count; i++)
                                    {
                                        //if (!_FirstSelectAnbar_NextSanad)
                                        //{
                                        //    _AnbarId = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "AnbarId"));

                                        //    var pp1 = q.Where(s => s.AnbarId == _AnbarId).ToList();
                                        //    //var ss1 = q2.FirstOrDefault(s => s.BeAnbarId == _BeAnbarId);
                                        //    //_SeryalCol_BeNameAmaliat_BaSelectAnbar = ss1 != null ? ss1.SeryalCol_BeNameAmaliat_BaSelectAnbar : pp1.Count > 0 ? pp1.Max(s => s.SeryalCol_BeNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp2 = pp1.Where(s => s.NameAmaliatCode == _NameAmaliatCode).ToList();
                                        //    var ss2 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.AnbarId == _AnbarId);
                                        //    _FNumber_BaNameAmaliat_BaSelectAnbar = ss2 != null ? ss2.FNumber_BaNameAmaliat_BaSelectAnbar : pp2.Count > 0 ? pp2.Max(s => s.FNumber_BaNameAmaliat_BaSelectAnbar) + 1 : 1;

                                        //    var pp3 = pp2.Where(s => s.NameSanadCode == _NameSanadCode).ToList();
                                        //    var ss3 = q2.FirstOrDefault(s => s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode && s.AnbarId == _AnbarId);
                                        //    _FNumberJoze_BaNameSanad_BaSelectAnbar = ss3 != null ? ss3.FNumberJoze_BaNameSanad_BaSelectAnbar : pp3.Count > 0 ? pp3.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1 : 1;
                                        //}

                                        _Ez_KsId = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "Ez_KsId"));
                                        //_VahedeKalaId = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "VahedeKalaId"));
                                        //long _Code = Convert.ToInt64(gridView_AmaliatAddVaEdit.GetRowCellValue(i, "KalaCode_NM"));
                                        _Meghdar = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Ksorat.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Ksorat.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Ksorat.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Ksorat.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        if (list_Ksorat[i].Id > 0)
                                        {

                                            var v1 = q2.FirstOrDefault(s => s.Id == list_Ksorat[i].Id);

                                            //v1.SalId = _SalId;
                                            //v1.AnbarId = _AnbarId;
                                            //v1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            //v1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            v1.RozaneSanadNumber = _RozaneSanadNumber;
                                            v1.PaygiriNumber = _PaygiriNumber;
                                            v1.Ez_KsId = _Ez_KsId;
                                            //v1.VahedeKalaId = _VahedeKalaId;
                                            v1.DateTimePaygiri = _DateTimePaygiri;
                                            v1.DateTimeSanad = _DateTimeSanad;
                                            v1.DateTimeEdit = _DateTimeEdit;
                                            //v1.NameAmaliatCode = _NameAmaliatCode;
                                            //v1.NameSanadCode = _NameSanadCode;
                                            //v1.NameSanadText = _NameSanadText;
                                            //v1.NameSanadIndex = _NameSanadIndex;
                                            v1.NoeSanadIndex = _NoeSanadIndex;
                                            v1.NoeSanadText = _NoeSanadText;
                                            //v1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //v1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            v1.SefareshId = _SefareshId;
                                            v1.SanadMabnaId = _SanadMabnaId;
                                            v1.Meghdar = _Meghdar;
                                            v1.Nerkh = _Nerkh;
                                            v1.Mablag = _Mablag;
                                            //v1.Motefareghe = _Motefareghe;
                                            //v1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //v1.Maliat = _Maliat;
                                            //v1.Avarez = _Avarez;
                                            //v1.IsRiali = _Mablag > 0 ? true : false;
                                            v1.Tozihat = _Tozihat;
                                            v1.SharhSanad = _SharhSanad;
                                            v1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            v1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            v1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            v1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            v1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            v1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            v1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            v1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            EditList.Add(v1);
                                        }
                                        else
                                        {

                                            FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                            obj1.SalId = _SalId;
                                            obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                            obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                            obj1.NoeFactor = _NoeFactor;
                                            obj1.IndexAghlamFactor = 3;
                                            //obj1.AnbarId = _AnbarId;
                                            obj1.Ez_KsId = _Ez_KsId;
                                            //obj1.VahedeKalaId = _VahedeKalaId;
                                            //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.GhateySanadNamber = _GhateySanadNamber;
                                            obj1.SabetAtefNumber = _SabetAtefNumber;
                                            obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.DateTimePaygiri = _DateTimePaygiri;
                                            obj1.DateTimeSanad = _DateTimeSanad;
                                            obj1.DateTimeInsert = _DateTimeInsert;
                                            obj1.NameAmaliatCode = _NameAmaliatCode;
                                            obj1.NameSanadCode = _NameSanadCode;
                                            obj1.NameSanadText = _NameSanadText;
                                            obj1.NameSanadIndex = _NameSanadIndex;
                                            obj1.NoeSanadIndex = _NoeSanadIndex;
                                            obj1.NoeSanadText = _NoeSanadText;
                                            //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            obj1.SefareshId = _SefareshId;
                                            obj1.SanadMabnaId = _SanadMabnaId;
                                            obj1.Meghdar = _Meghdar;
                                            obj1.Nerkh = _Nerkh;
                                            obj1.Mablag = _Mablag;
                                            //obj1.Motefareghe = _Motefareghe;
                                            //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //obj1.Maliat = _Maliat;
                                            //obj1.Avarez = _Avarez;
                                            //obj1.IsRiali = _Mablag > 0 ? true : false;
                                            obj1.Radif = i + 1;
                                            obj1.Tozihat = _Tozihat;
                                            obj1.SharhSanad = _SharhSanad;
                                            //if (!string.IsNullOrEmpty(cmbSefaresh.Text))
                                            //obj1.SefareshId = Convert.ToInt32(cmbSefaresh.EditValue);
                                            //obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            //obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            AddList.Add(obj1);
                                        }
                                    }
                                    //var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.AnbarId == null && s.EpNameKala1.EpGroupFareeKala1.EpGroupAsliKala1.EpTabaghehKala1.NoeTabagheIndex == 3 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    //&& s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    //if (qq1.Count > 0)
                                    //{
                                    //    for (int j = 0; j < qq1.Count; j++)
                                    //    {
                                    //        qq1[j].Radif = j + 1;
                                    //    }
                                    //    db.SaveChanges();
                                    //}

                                }
                                ////////////// ویزیتور فاکتور///////////
                                //if (gridView_Vizitor.RowCount > 0)
                                {
                                    _AnbarId = null;
                                    _KalaId = null;
                                    //_VahedeKalaId = null;
                                    _SanadMabnaId = null;
                                    _SefareshId = null;

                                    List<FkAmaliatFrooshVKharid_Riz> list_Vizitor = ((IEnumerable)gridView_Vizitor.DataSource).Cast<FkAmaliatFrooshVKharid_Riz>().ToList();

                                    List<FkAmaliatFrooshVKharid_Riz> q2 = new List<FkAmaliatFrooshVKharid_Riz>();

                                    var qq2 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.IndexAghlamFactor == 4 && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    foreach (var item in qq2)
                                    {
                                        if (!list_Vizitor.Any(s => s.Id == item.Id))
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            RemoveList.Add(pp);
                                        }
                                        else
                                        {
                                            var pp = qq2.FirstOrDefault(s => s.Id == item.Id);
                                            q2.Add(pp);

                                        }
                                    }


                                    //var q = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId).ToList();
                                    for (int i = 0; i < list_Vizitor.Count; i++)
                                    {
                                        _VizitorId = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "VizitorId"));
                                        _Meghdar = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Meghdar"));
                                        _Nerkh = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Nerkh"));
                                        _Mablag = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Mablag"));
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Motefareghe")) != 0) _Motefareghe = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Motefareghe")); else _Motefareghe = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "TakhfifRadifiKala")) != 0) TakhfifRadifiKala = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "TakhfifRadifiKala")); else TakhfifRadifiKala = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Maliat")) != 0) _Maliat = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Maliat")); else _Maliat = null;
                                        //if (Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Avarez")) != 0) _Avarez = Convert.ToDecimal(gridView_Vizitor.GetRowCellValue(i, "Avarez")); else _Avarez = null;
                                        _Tozihat = !string.IsNullOrEmpty(gridView_Vizitor.GetRowCellDisplayText(i, "Tozihat")) ? gridView_Vizitor.GetRowCellDisplayText(i, "Tozihat") : null;

                                        _HesabMoinId_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabMoinId_Bed"));
                                        _HesabTafsili1Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili1Id_Bed"));
                                        _HesabTafsili2Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili2Id_Bed"));
                                        _HesabTafsili3Id_Bed = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili3Id_Bed"));
                                        _HesabMoinId_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabMoinId_Bes"));
                                        _HesabTafsili1Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili1Id_Bes"));
                                        _HesabTafsili2Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili2Id_Bes"));
                                        _HesabTafsili3Id_Bes = Convert.ToInt32(gridView_Vizitor.GetRowCellValue(i, "HesabTafsili3Id_Bes"));

                                        if (list_Vizitor[i].Id > 0)
                                        {

                                            var v1 = q2.FirstOrDefault(s => s.Id == list_Vizitor[i].Id);

                                            //v1.SalId = _SalId;
                                            //v1.AnbarId = _AnbarId;
                                            //v1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.FNumberJoze_BaNameSanad_BaSelectAnbar = _FNumberJoze_BaNameSanad_BaSelectAnbar;
                                            //v1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //v1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            v1.RozaneSanadNumber = _RozaneSanadNumber;
                                            v1.PaygiriNumber = _PaygiriNumber;
                                            v1.VizitorId = _VizitorId;
                                            //v1.KalaId = _KalaId;
                                            //v1.VahedeKalaId = _VahedeKalaId;
                                            v1.DateTimePaygiri = _DateTimePaygiri;
                                            v1.DateTimeSanad = _DateTimeSanad;
                                            v1.DateTimeEdit = _DateTimeEdit;
                                            //v1.NameAmaliatCode = _NameAmaliatCode;
                                            //v1.NameSanadCode = _NameSanadCode;
                                            //v1.NameSanadText = _NameSanadText;
                                            //v1.NameSanadIndex = _NameSanadIndex;
                                            v1.NoeSanadIndex = _NoeSanadIndex;
                                            v1.NoeSanadText = _NoeSanadText;
                                            //v1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //v1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            //v1.SefareshId = _SefareshId;
                                            //v1.SanadMabnaId = _SanadMabnaId;
                                            v1.Meghdar = _Meghdar;
                                            v1.Nerkh = _Nerkh;
                                            v1.Mablag = _Mablag;
                                            //v1.Motefareghe = _Motefareghe;
                                            //v1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //v1.Maliat = _Maliat;
                                            //v1.Avarez = _Avarez;
                                            //v1.IsRiali = _Mablag > 0 ? true : false;
                                            v1.Tozihat = _Tozihat;
                                            v1.SharhSanad = _SharhSanad;
                                            v1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            v1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            v1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            v1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            v1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            v1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            v1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            v1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            EditList.Add(v1);
                                        }
                                        else
                                        {

                                            FkAmaliatFrooshVKharid_Riz obj1 = new FkAmaliatFrooshVKharid_Riz();
                                            obj1.SalId = _SalId;
                                            obj1.FNumber_BeNameAmaliat_BeSelectAnbar = _FNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BeSelectAnbar = _FNumber_BaNameAmaliat_BeSelectAnbar;
                                            obj1.FNumberCol_BaNameSanad_BeSelectAnbar = _FNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.FNumber_BaNameAmaliat_BaSelectAnbar = _FNumber_BaNameAmaliat_BaSelectAnbar;
                                            obj1.FNumberJoze_BaNameSanad_BaSelectAnbar = 0;
                                            obj1.FNumberJoze_BaNameSanad_BaNoeFactor = _FNumberJoze_BaNameSanad_BaNoeFactor;
                                            obj1.IndexAghlamFactor = 4;
                                            obj1.VizitorId = _VizitorId;
                                            //obj1.AnbarId = _AnbarId;
                                            //obj1.KalaId = _KalaId;
                                            //obj1.VahedeKalaId = _VahedeKalaId;
                                            //obj1.SNumber_BeNameAmaliat_BeSelectAnbar = _SNumber_BeNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BeSelectAnbar = _SNumber_BaNameAmaliat_BeSelectAnbar;
                                            //obj1.SNumberCol_BaNameSanad_BeSelectAnbar = _SNumberCol_BaNameSanad_BeSelectAnbar;
                                            //obj1.SNumber_BaNameAmaliat_BaSelectAnbar = _SNumber_BaNameAmaliat_BaSelectAnbar;
                                            //obj1.SNumberJoze_BaNameSanad_BaSelectAnbar = _SNumberJoze_BaNameSanad_BaSelectAnbar;
                                            obj1.GhateySanadNamber = _GhateySanadNamber;
                                            obj1.SabetAtefNumber = _SabetAtefNumber;
                                            obj1.RozaneSanadNumber = _RozaneSanadNumber;
                                            obj1.PaygiriNumber = _PaygiriNumber;
                                            obj1.DateTimePaygiri = _DateTimePaygiri;
                                            obj1.DateTimeSanad = _DateTimeSanad;
                                            obj1.DateTimeInsert = _DateTimeInsert;
                                            obj1.NoeFactor = _NoeFactor;
                                            obj1.NameAmaliatCode = _NameAmaliatCode;
                                            obj1.NameSanadCode = _NameSanadCode;
                                            obj1.NameSanadText = _NameSanadText;
                                            obj1.NameSanadIndex = _NameSanadIndex;
                                            obj1.NoeSanadIndex = _NoeSanadIndex;
                                            obj1.NoeSanadText = _NoeSanadText;
                                            //obj1.NoeSanadIndex_Khadamat = _NoeSanadIndex_Khadamat;
                                            //obj1.NoeSanadText_Khadamat = _NoeSanadText_Khadamat;
                                            //obj1.SefareshId = _SefareshId;
                                            //obj1.SanadMabnaId = _SanadMabnaId;
                                            obj1.Meghdar = _Meghdar;
                                            obj1.Nerkh = _Nerkh;
                                            obj1.Mablag = _Mablag;
                                            //obj1.Motefareghe = _Motefareghe;
                                            //obj1.TakhfifRadifiKala = TakhfifRadifiKala;
                                            //obj1.Maliat = _Maliat;
                                            //obj1.Avarez = _Avarez;
                                            //obj1.IsRiali = _Mablag > 0 ? true : false;
                                            obj1.Radif = i + 1;
                                            obj1.Tozihat = _Tozihat;
                                            obj1.SharhSanad = _SharhSanad;
                                            obj1.HesabMoinId_Bed = _HesabMoinId_Bed;
                                            obj1.HesabTafsili1Id_Bed = _HesabTafsili1Id_Bed;
                                            obj1.HesabTafsili2Id_Bed = _HesabTafsili2Id_Bed;
                                            obj1.HesabTafsili3Id_Bed = _HesabTafsili3Id_Bed;
                                            obj1.HesabMoinId_Bes = _HesabMoinId_Bes;
                                            obj1.HesabTafsili1Id_Bes = _HesabTafsili1Id_Bes;
                                            obj1.HesabTafsili2Id_Bes = _HesabTafsili2Id_Bes;
                                            obj1.HesabTafsili3Id_Bes = _HesabTafsili3Id_Bes;

                                            AddList.Add(obj1);
                                        }
                                    }
                                    //var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.VizitorId != null && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                    //&& s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();
                                    //if (qq1.Count > 0)
                                    //{
                                    //    for (int j = 0; j < qq1.Count; j++)
                                    //    {
                                    //        qq1[j].Radif = j + 1;
                                    //    }
                                    //    db.SaveChanges();
                                    //}

                                }


                                db.FkAmaliatFrooshVKharid_Rizs.RemoveRange(RemoveList);
                                db.FkAmaliatFrooshVKharid_Rizs.AddRange(AddList);

                                db.SaveChanges();

                                var qq1 = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode
                                && s.FNumberCol_BaNameSanad_BeSelectAnbar == _FNumberCol_BaNameSanad_BeSelectAnbar && s.FNumberJoze_BaNameSanad_BaNoeFactor == _FNumberJoze_BaNameSanad_BaNoeFactor).ToList();

                                var qq1_Kala = qq1.Where(s => s.IndexAghlamFactor == 0).ToList();
                                var qq1_Khadamat = qq1.Where(s => s.IndexAghlamFactor == 1).ToList();
                                var qq1_Ezafat = qq1.Where(s => s.IndexAghlamFactor == 2).ToList();
                                var qq1_Ksorat = qq1.Where(s => s.IndexAghlamFactor == 3).ToList();
                                var qq1_Vizitor = qq1.Where(s => s.IndexAghlamFactor == 4).ToList();

                                if (qq1_Kala.Count > 0)
                                    for (int j = 0; j < qq1_Kala.Count; j++) { qq1_Kala[j].Radif = j + 1; }
                                if (qq1_Khadamat.Count > 0)
                                    for (int j = 0; j < qq1_Khadamat.Count; j++) { qq1_Khadamat[j].Radif = j + 1; }
                                if (qq1_Ezafat.Count > 0)
                                    for (int j = 0; j < qq1_Ezafat.Count; j++) { qq1_Ezafat[j].Radif = j + 1; }
                                if (qq1_Ksorat.Count > 0)
                                    for (int j = 0; j < qq1_Ksorat.Count; j++) { qq1_Ksorat[j].Radif = j + 1; }
                                if (qq1_Vizitor.Count > 0)
                                    for (int j = 0; j < qq1_Vizitor.Count; j++) { qq1_Vizitor[j].Radif = j + 1; }

                                db.SaveChanges();
                            }

                            En1 = EnumCED.Save;
                            if (sender == btnSaveAndClosed || sender == null)
                                this.Close();
                            else if (sender == btnSaveAndNext)
                                NewAction();
                        }

                    }
                    catch (Exception ex)
                    {
                        XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.ToString(),
                            "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }

            }

        }

        private void cmbSefaresh_Enter(object sender, EventArgs e)
        {
            //if (En1 == EnumCED.Create)
            //    cmbSefaresh.ShowPopup();

        }

        private void cmbNameSanad_SelectedIndexChanged(object sender, EventArgs e)
        {
            FillCmbHesabMoin();
            txtTarikhSanad.Text = DateTime.Now.ToString();

            using (var db = new MyContext())
            {
                try
                {
                    //_NameSanadIndex = cmbNameSanad.SelectedIndex;
                    ////_NameSanadText = cmbNameSanad.Text;
                    ////xtpAmaliatAddVEdit.Text = titelAmaliatAddVEdit + " : " + "نوع سند" + " : " + _NameSanadText;
                    //if (cmbNameSanad.SelectedIndex < 0 || cmbNameSanad.Text == "" || string.IsNullOrEmpty(cmbNameSanad.Text))
                    //{
                    //    if (En1 == EnumCED.Create)
                    //    {

                    //        XtraMessageBox.Show("نوع سند مشخص نیست", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    //        //cmbNameSanad.ShowPopup();
                    //        return;
                    //    }

                    //}

                    //switch (cmbNameSanad.SelectedIndex)
                    //{
                    //    case 0:
                    //        _NameSanadCode = 201;
                    //        _NameAmaliatCode = 2;
                    //        break;
                    //    case 1:
                    //        _NameSanadCode = 202;
                    //        _NameAmaliatCode = 2;
                    //        break;
                    //    case 2:
                    //        _NameSanadCode = 203;
                    //        _NameAmaliatCode = 2;
                    //        break;
                    //    case 3:
                    //        _NameSanadCode = 204;
                    //        _NameAmaliatCode = 2;
                    //        break;
                    //    case 4:
                    //        _NameSanadCode = 101;
                    //        _NameAmaliatCode = 1;
                    //        break;
                    //    case 5:
                    //        _NameSanadCode = 102;
                    //        _NameAmaliatCode = 1;
                    //        break;
                    //    case 6:
                    //        _NameSanadCode = 103;
                    //        _NameAmaliatCode = 1;
                    //        break;
                    //    case 7:
                    //        _NameSanadCode = 104;
                    //        _NameAmaliatCode = 1;
                    //        break;
                    //}

                    _NameSanadIndex = cmbNameSanad.SelectedIndex;

                    if (En1 == EnumCED.Create)
                    {
                        var qp = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode).ToList();
                        txtFNumberCol_BaNameSanad_BeSelectAnbar.Text = qp.Count > 0 ? (qp.Max(s => s.FNumberCol_BaNameSanad_BeSelectAnbar) + 1).ToString() : "1";
                        txtFNumberJoze_BaNameSanad_BaNoeFactor.Text = qp.Where(s => s.NoeFactor == _NoeFactor).Count() > 0 ? (qp.Where(s => s.NoeFactor == _NoeFactor).Max(s => s.FNumberJoze_BaNameSanad_BaNoeFactor) + 1).ToString() : "1";
                    }
                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }


        }

        private void btnReloadHesabMoin_Click(object sender, EventArgs e)
        {
            FillCmbHesabMoin();

        }

        private void cmbHesabMoin_EditValueChanged(object sender, EventArgs e)
        {
            using (var db = new MyContext())
            {
                try
                {
                    FillCmbHesabTafsili();
                    _SalId = Convert.ToInt32(lblSalId.Text);
                    int _HesabMoinId = Convert.ToInt32(cmbHesabMoin.EditValue);
                    var q = db.EpHesabMoin1s.FirstOrDefault(s => s.SalId == _SalId && s.Id == _HesabMoinId);
                    if (q != null)
                    {
                        switch (q.GroupTafsiliLevelsIndex)
                        {
                            case 0:
                                {
                                    cmbHesabTafsili1.ReadOnly = cmbHesabTafsili2.ReadOnly = cmbHesabTafsili3.ReadOnly = true;
                                    break;
                                }
                            case 1:
                                {
                                    cmbHesabTafsili1.ReadOnly = false;
                                    cmbHesabTafsili2.ReadOnly = cmbHesabTafsili3.ReadOnly = true;
                                    break;
                                }
                            case 2:
                                {
                                    cmbHesabTafsili1.ReadOnly = cmbHesabTafsili2.ReadOnly = false;
                                    cmbHesabTafsili3.ReadOnly = true;
                                    break;
                                }
                            case 3:
                                {
                                    cmbHesabTafsili1.ReadOnly = cmbHesabTafsili2.ReadOnly = cmbHesabTafsili3.ReadOnly = false;
                                    break;
                                }
                            default:
                                break;
                        }

                    }
                    cmbHesabTafsili1_EditValueChanged(null, null);
                    if (Convert.ToInt32(cmbHesabMoin.EditValue) > 0)
                    {
                        btnInsert1.Enabled = true;
                    }
                    else
                    {
                        btnInsert1.Enabled = false;
                    }

                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }

        private void FrmFactor_Shown(object sender, EventArgs e)
        {
            //txtMabKhalesKala.Text = gridView_AghlamKala.Columns["MablagKhales_Kala"].SummaryText;
            // txtMabKhalesKhadamat.Text = gridView_AghlamKhadamat.Columns["MablagKhales_Khadamat"].SummaryText;
            decimal _txtMabKhalesKala = Convert.ToDecimal(gridView_AghlamKala.Columns["Mablag"].SummaryText) + Convert.ToDecimal(gridView_AghlamKala.Columns["Motefareghe"].SummaryText) - Convert.ToDecimal(gridView_AghlamKala.Columns["TakhfifRadifiKala"].SummaryText);
            decimal _txtMabKhalesKhadamat = Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Mablag"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Motefareghe"].SummaryText) - Convert.ToDecimal(gridView_AghlamKhadamat.Columns["TakhfifRadifiKala"].SummaryText);
            txtMabKhalesKala.Text = _txtMabKhalesKala.ToString("n0");
            txtMabKhalesKhadamat.Text = _txtMabKhalesKhadamat.ToString("n0");
            txtJamMabKhales.Text = (_txtMabKhalesKala + _txtMabKhalesKhadamat).ToString("n0");

            txtMabMaliat.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Maliat"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Maliat"].SummaryText)).ToString("n0");
            txtMabAvarez.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Avarez"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Avarez"].SummaryText)).ToString("n0");

            txtMabEzafat.Text = gridView_Ezafat.Columns["Mablag"].SummaryText;
            txtMabKsorat.Text = gridView_Ksorat.Columns["Mablag"].SummaryText;
            txtDarsadMabEzafat.Text = gridView_Ezafat.Columns["Meghdar"].SummaryText;
            txtDarsadMabKsorat.Text = gridView_Ksorat.Columns["Meghdar"].SummaryText;

            MohasebeJameMandeHesab();
            cmbNameSanad.Focus();

        }

        private void btnDelete1_Click(object sender, EventArgs e)
        {
            if (XtraTabControl1.SelectedTabPage == xtp_AghlamKala)
            {
                gridControl1 = gridControl_AghlamKala;
                gridView1 = gridView_AghlamKala;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_AghlamKhadamat)
            {
                gridControl1 = gridControl_AghlamKhadamat;
                gridView1 = gridView_AghlamKhadamat;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ezafat)
            {
                gridControl1 = gridControl_Ezafat;
                gridView1 = gridView_Ezafat;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Ksorat)
            {
                gridControl1 = gridControl_Ksorat;
                gridView1 = gridView_Ksorat;
            }
            else if (XtraTabControl1.SelectedTabPage == xtp_Vizitor)
            {
                gridControl1 = gridControl_Vizitor;
                gridView1 = gridView_Vizitor;
            }


            if (gridView1.RowCount > 0)
            {
                if (XtraMessageBox.Show("آیا ردیف انتخابی حذف گردد؟", "پیغام حذف", MessageBoxButtons.YesNo, MessageBoxIcon.Information) == DialogResult.Yes)
                {
                    //gridView_AmaliatAddVaEdit.DeleteSelectedRows();
                    gridView1.DeleteRow(gridView1.FocusedRowHandle);
                    gridView1.UpdateSummary();
                    FillVaziyatHesab();
                }
            }

        }

        private void cmbHesabMoin_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create)
            {
                cmbHesabMoin.ShowPopup();
            }
        }

        bool _IsActiveRow = true;

        private void cmbControl_CustomDrawCell(object sender, DevExpress.XtraEditors.Popup.LookUpCustomDrawCellArgs e)
        {
            if (!_IsActiveRow)
                e.Appearance.ForeColor = Color.Red;

            if (e.Header.Caption == "فعال" && e.DisplayText == "True")
                e.DisplayText = "بله";
            if (e.Header.Caption == "فعال" && e.DisplayText == "False")
                e.DisplayText = "خیر";
            //if (e.Header.Caption == "اجازه موجودی منفی" && e.DisplayText == "True")
            //    e.DisplayText = "بله";
            //if (e.Header.Caption == "اجازه موجودی منفی" && e.DisplayText == "False")
            //    e.DisplayText = "خیر";

        }

        private void cmbControl_CustomDrawRow(object sender, DevExpress.XtraEditors.Popup.LookUpCustomDrawRowArgs e)
        {
            _IsActiveRow = Convert.ToBoolean(e.GetCellValue(0));

        }

        private void cmbHesabTafsili1_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create)
            {
                cmbHesabTafsili1.ShowPopup();
            }
        }

        private void cmbHesabTafsili2_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create)
            {
                cmbHesabTafsili2.ShowPopup();
            }

        }

        private void cmbHesabTafsili3_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create)
            {
                cmbHesabTafsili3.ShowPopup();
            }

        }

        //private void cmbNameAnbar_CustomDrawCell(object sender, DevExpress.XtraEditors.Popup.LookUpCustomDrawCellArgs e)
        //{
        //    if (!_IsActiveRow)
        //        e.Appearance.ForeColor = Color.Red;

        //    if (e.Header.Caption == "فعال" && e.DisplayText == "True")
        //        e.DisplayText = "بله";
        //    if (e.Header.Caption == "فعال" && e.DisplayText == "False")
        //        e.DisplayText = "خیر";
        //    if (e.Header.Caption == "اجازه موجودی منفی" && e.DisplayText == "True")
        //        e.DisplayText = "بله";
        //    if (e.Header.Caption == "اجازه موجودی منفی" && e.DisplayText == "False")
        //        e.DisplayText = "خیر";

        //}

        //private void cmbNameAnbar_CustomDrawRow(object sender, DevExpress.XtraEditors.Popup.LookUpCustomDrawRowArgs e)
        //{
        //    _IsActiveRow = Convert.ToBoolean(e.GetCellValue(0));

        //}

        private void btnReloadNameAnbar_Click(object sender, EventArgs e)
        {
            FillCmbAnbarName();

        }

        bool ClikBtnClosed = false;
        private void btnClose_Click(object sender, EventArgs e)
        {
            ClikBtnClosed = true;
            if ((gridView_AghlamKala.RowCount > 0 && _NoeFactor == 0) || (gridView_AghlamKhadamat.RowCount > 0 && _NoeFactor == 1))
            {
                var Result = XtraMessageBox.Show("آیا اطلاعات ذخیره گردد؟", "پیغام خروج", MessageBoxButtons.YesNoCancel, MessageBoxIcon.Information);
                if (Result == DialogResult.Yes)
                {
                    btnSaveAndClosed_Click(null, null);
                    //En1 = EnumCED.Cancel;
                }
                else if (Result == DialogResult.No)
                {
                    En1 = EnumCED.Cancel;
                    this.Close();
                }
                else
                {
                    return;
                }
            }
            else
            {
                En1 = EnumCED.Cancel;
                this.Close();

            }

        }

        private void btnSaveAndPrintAndClosed_Click(object sender, EventArgs e)
        {
            if (btnSaveAndPrintAndClosed.Enabled)
            {
                btnSaveAndClosed_Click(null, null);

            }
        }


        private void btnRemoveSefaresh_Click(object sender, EventArgs e)
        {
            cmbSefaresh.EditValue = 0;
        }

        private void btnRemoveSanadMabna_Click(object sender, EventArgs e)
        {
            cmbSanadMabna.EditValue = 0;
        }

        private void cmbNoe_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create && cmbNoeSanad.SelectedIndex == -1)
                cmbNoeSanad.ShowPopup();
        }

        private void cmbSanadMabna_Enter(object sender, EventArgs e)
        {
            //if (En1 == EnumCED.Create && string.IsNullOrEmpty(cmbSanadMabna.Text))
            //    cmbSanadMabna.ShowPopup();

        }

        private void cmbNameAnbar_Enter(object sender, EventArgs e)
        {
            if (En1 == EnumCED.Create)
                cmbNameAnbar.ShowPopup();
        }

        private void cmbNameAnbar_EditValueChanged(object sender, EventArgs e)
        {
            using (var db = new MyContext())
            {
                try
                {
                    //_NameSanadIndex = cmbNameSanad.SelectedIndex;
                    //if (cmbNameSanad.SelectedIndex < 0 || cmbNameSanad.Text == "" || string.IsNullOrEmpty(cmbNameSanad.Text))
                    //{

                    //    XtraMessageBox.Show("نوع سند مشخص نیست", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    //    return;
                    //}

                    if (En1 == EnumCED.Create)
                    {
                        var qp = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode).ToList();
                        if (_FirstSelectAnbar_NextSanad && _NoeFactor == 0)
                        {
                            _AnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                            var qq = qp.Where(s => s.AnbarId == _AnbarId).ToList();
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text = qq.Count > 0 ? (qq.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1).ToString() : "1";
                        }
                    }
                    else if (En1 == EnumCED.Edit && _FirstSelectAnbar_NextSanad && _NoeFactor == 0 && txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text != "0")
                    {
                        //_FNumberJoze_BaNameSanad_BaSelectAnbar = Convert.ToInt32(txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text);
                        if (_BeforEditAnbarId == Convert.ToInt32(cmbNameAnbar.EditValue))
                        {
                            txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text = _FNumberJoze_BaNameSanad_BaSelectAnbar.ToString();
                        }
                        else
                        {

                            var qp = db.FkAmaliatFrooshVKharid_Rizs.Where(s => s.SalId == _SalId && s.NameAmaliatCode == _NameAmaliatCode && s.NameSanadCode == _NameSanadCode).ToList();
                            if (_FirstSelectAnbar_NextSanad && _NoeFactor == 0)
                            {
                                _AnbarId = Convert.ToInt32(cmbNameAnbar.EditValue);
                                var qq = qp.Where(s => s.AnbarId == _AnbarId).ToList();
                                txtFNumberJoze_BaNameSanad_BaSelectAnbar.Text = qq.Count > 0 ? (qq.Max(s => s.FNumberJoze_BaNameSanad_BaSelectAnbar) + 1).ToString() : "1";
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }

            btnInsert1.Focus();
        }

        private void txtSharhSanad_Leave(object sender, EventArgs e)
        {
            if (Convert.ToInt32(cmbHesabMoin.EditValue) != 0)
                btnInsert1.Focus();
            else
                cmbHesabMoin.Focus();

        }

        private void chkEditCode_CheckedChanged(object sender, EventArgs e)
        {
            txtRozaneSanadNumber.Enabled = chkEditCode.Checked ? true : false;
            txtRozaneSanadNumber.Focus();
        }

        private void FrmFactor_FormClosed(object sender, FormClosedEventArgs e)
        {
            if (Fm != null)
            {
                Fm.FillGridControl();
            }
            if (dbContext != null)
                dbContext.Dispose();
        }

        private void chkEditNoeSanad_CheckedChanged(object sender, EventArgs e)
        {
            cmbNoeSanad.Enabled = chkEditNoeSanad.Checked ? true : false;
            cmbNoeSanad.Focus();

        }

        public void NewAction()
        {
            HelpClass1.ClearControls(xtp_OrginalData);
            HelpClass1.ClearControls(xtp_AdressVTamas);
            HelpClass1.ClearControls(xtp_Etebar);
            HelpClass1.ClearControls(xtp_Takhfif);
            HelpClass1.ClearControls(xtp_Ranande);
            HelpClass1.ClearControls(xtp_Vizitor2);
            HelpClass1.ClearControls(xtp_Sayer);
            HelpClass1.ClearControls(panelControl_NameAnbar);
            fkAmaliatFrooshVKharid_RizsBindingSource_Kala.Clear();
            fkAmaliatFrooshVKharid_RizsBindingSource_Khadamat.Clear();
        }
        private void btnSaveAndNext_Click(object sender, EventArgs e)
        {
            if (btnSaveAndNext.Enabled)
            {
                //IsClosed_AmaliatFooeshVKharid = false;
                btnSaveAndClosed_Click(sender, null);

                if (En1 == EnumCED.Save)
                {
                    using (var db = new MyContext())
                    {
                        try
                        {

                            En1 = EnumCED.Create;
                            FrmFactor_Load(null, null);
                            XtraMessageBox.Show("اطلاعات ذخیره شد", "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Information);
                        }
                        catch (Exception ex)
                        {
                            XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                                "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        }
                    }
                }

            }

        }

        private void cmbHesabTafsili1_EditValueChanged(object sender, EventArgs e)
        {
            if (!string.IsNullOrEmpty(cmbHesabTafsili1.Text))
                _HesabTafsili1Id_Bed = Convert.ToInt32(cmbHesabTafsili1.EditValue);
            else
                _HesabTafsili1Id_Bed = 0;
            using (var db = new MyContext())
            {
                try
                {
                    _SalId = Convert.ToInt32(lblSalId.Text);
                    var q = db.EpHesabTafsiliAshkhass.FirstOrDefault(s => s.SalId == _SalId && s.LevelNumber == 1 && s.Id == _HesabTafsili1Id_Bed);
                    if (q != null)
                    {
                        var q_Adress = db.EpAdress_As.Where(s => s.SalId == _SalId && s.AshkhasId == q.Id).ToList();
                        if (q_Adress.Count > 0)
                            epAdress_AsBindingSource.DataSource = q_Adress;
                        else
                            epAdress_AsBindingSource.Clear();

                        var q_ShomareTamas = db.EpShTamas_As.Where(s => s.SalId == _SalId && s.AshkhasId == q.Id).ToList();
                        if (q_ShomareTamas.Count > 0)
                            epShTamas_AsBindingSource.DataSource = q_ShomareTamas;
                        else
                            epShTamas_AsBindingSource.Clear();

                        var q_Moshakhasat = db.EpMoshakhasat_As.Where(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == q.Id).ToList();
                        if (q_Moshakhasat.Count > 0)
                            epMoshakhasat_AsBindingSource.DataSource = q_Moshakhasat;
                        else
                            epMoshakhasat_AsBindingSource.Clear();

                        var q_NameBank = db.EpHesabBanki_As.Where(s => s.SalId == _SalId && s.AshkhasId == q.Id).ToList();
                        if (q_NameBank.Count > 0)
                            epHesabBanki_AsBindingSource.DataSource = q_NameBank;
                        else
                            epHesabBanki_AsBindingSource.Clear();

                        var q_Etebar = db.EpEetebarat_As.Where(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id_Bed).ToList();
                        if (q_Etebar.Count > 0)
                        {
                            epEetebarat_AsBindingSource.DataSource = q_Etebar;
                            cmbEtebar.EditValue = q_Etebar.FirstOrDefault(s => s.IsDefault == true) != null ? q_Etebar.FirstOrDefault(s => s.IsDefault == true).Id : 0;
                        }

                        var q_Takhfif = db.EpDarsadTakhfif_As.Where(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id_Bed).ToList();
                        if (q_Takhfif.Count > 0)
                        {
                            epDarsadTakhfif_AsBindingSource.DataSource = q_Takhfif;
                            cmbTakhfif.EditValue = q_Takhfif.FirstOrDefault(s => s.IsDefault == true) != null ? q_Takhfif.FirstOrDefault(s => s.IsDefault == true).Id : 0;
                        }

                        //var q_Adress = db.EpAdress_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == q.Id && s.IsDefault == true);
                        //if (q_Adress != null)
                        //{
                        //    cmbNameAdress.EditValue = q_Adress.NameAdressId != null ? q_Adress.NameAdressId : 0;
                        //    cmbNameOstan.EditValue = q_Adress.NameOstanId != null ? q_Adress.NameOstanId : 0;
                        //    cmbNameShahrstan.EditValue = q_Adress.NameShahrstanId != null ? q_Adress.NameShahrstanId : 0;
                        //    txtSharhAdress.Text = q_Adress.SharhAdress != null ? q_Adress.SharhAdress : "";
                        //    txtCodePosti.Text = q_Adress.CodePosti != null ? q_Adress.CodePosti : "";
                        //    txtSandoghPosti.Text = q_Adress.SandoghPosti != null ? q_Adress.SandoghPosti : "";

                        //}

                        //var q_Moshakhasat = db.EpMoshakhasat_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == q.Id);
                        //if (q_Moshakhasat != null)
                        //{
                        //    txtShenaseMelli.Text = q_Moshakhasat.ShenaseMelli != null ? q_Moshakhasat.ShenaseMelli : "";
                        //    txtCodeEghtesadi.Text = q_Moshakhasat.CodeEghtesadi != null ? q_Moshakhasat.CodeEghtesadi : "";

                        //}

                        //var q_ShomareTamas = db.EpShTamas_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == q.Id && s.IsDefault == true);
                        //if (q_ShomareTamas != null)
                        //{
                        //    cmbNoeTamas.SelectedIndex = q_ShomareTamas.IndexNoeTamas != 0 ? q_ShomareTamas.IndexNoeTamas : 0;
                        //    txtShTamas.Text = q_ShomareTamas.ShTamas != null ? q_ShomareTamas.ShTamas : "";
                        //    txtNameGhesmat.Text = q_ShomareTamas.NameGhesmat != null ? q_ShomareTamas.NameGhesmat : "";
                        //    txtShDakheli.Text = q_ShomareTamas.ShDakheli != null ? q_ShomareTamas.ShDakheli : "";

                        //}

                        //var q_NameBank = db.EpHesabBanki_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == q.Id && s.IsDefault == true);
                        //if (q_NameBank != null)
                        //{
                        //    cmbNameBank.EditValue = q_NameBank.NameBankId != 0 ? q_NameBank.NameBankId : 0;
                        //    txtShomareHesab.Text = q_NameBank.ShomareHesab != null ? q_NameBank.ShomareHesab : "";
                        //    txtShomareKart.Text = q_NameBank.ShomareKart != null ? q_NameBank.ShomareKart : "";
                        //    txtShomareShaba.Text = q_NameBank.ShomareShaba != null ? q_NameBank.ShomareShaba : "";
                        //    txtShomareMoshtari.Text = q_NameBank.ShomareMoshtari != null ? q_NameBank.ShomareMoshtari : "";

                        //}

                        //var q_Etebar = db.EpEetebarat_As.Where(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id).ToList();
                        //if (q_Etebar.Count > 0)
                        //{
                        //    epEetebarat_AsBindingSource.DataSource = q_Etebar;
                        //    cmbEtebar.EditValue = q_Etebar.FirstOrDefault(s => s.IsDefault == true) != null ? q_Etebar.FirstOrDefault(s => s.IsDefault == true).Id : 0;
                        //}

                        //var q_Takhfif = db.EpDarsadTakhfif_As.Where(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id).ToList();
                        //if (q_Takhfif.Count > 0)
                        //{
                        //    epDarsadTakhfif_AsBindingSource.DataSource = q_Etebar;
                        //    cmbTakhfif.EditValue = q_Takhfif.FirstOrDefault(s => s.IsDefault == true) != null ? q_Takhfif.FirstOrDefault(s => s.IsDefault == true).Id : 0;
                        //}
                    }
                    else
                    {
                        epAdress_AsBindingSource.Clear();
                        epShTamas_AsBindingSource.Clear();
                        epMoshakhasat_AsBindingSource.Clear();
                        epHesabBanki_AsBindingSource.Clear();

                        //HelpClass1.ClearControls(xtp_AdressVTamas);
                        //HelpClass1.ClearControls(xtp_Etebar);
                        //HelpClass1.ClearControls(xtp_DarsadTakhfif);
                        //HelpClass1.ClearControls(xtp_Ranande);
                        //HelpClass1.ClearControls(xtp_Vizitor);
                        //HelpClass1.ClearControls(xtp_Sayer);

                    }
                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }

        private void chkEditNoeArz_CheckedChanged(object sender, EventArgs e)
        {
            cmbNoeArz_Bank.Enabled = chkEditNoeArz.Checked ? true : false;
            cmbNoeArz_Bank.Focus();

        }

        private void cmbEtebar_EditValueChanged(object sender, EventArgs e)
        {
            int _EtebarId = Convert.ToInt32(cmbEtebar.EditValue);
            using (var db = new MyContext())
            {
                try
                {
                    var q_Etebar = db.EpEetebarat_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id_Bed && s.Id == _EtebarId);
                    if (q_Etebar != null)
                    {
                        txtMablagh.Text = q_Etebar.Mablagh.ToString();
                        txtShGharadad.Text = q_Etebar.ShGharadad.ToString();
                        txtTaEngheza_E.Text = q_Etebar.TaEngheza.ToString();
                        chkEetebarat.Checked = q_Etebar.chkEetebarat;
                    }
                    else
                    {
                        txtMablagh.Text = "";
                        txtShGharadad.Text = "";
                        txtTaEngheza_E.Text = "";
                        chkEetebarat.Checked = true;
                    }

                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }

        }

        private void cmbTakhfif_EditValueChanged(object sender, EventArgs e)
        {
            int _TakhfifId = Convert.ToInt32(cmbTakhfif.EditValue);
            using (var db = new MyContext())
            {
                try
                {
                    var q_Takhfif = db.EpDarsadTakhfif_As.FirstOrDefault(s => s.SalId == _SalId && s.EpHesabTafsiliAshkhas1.Id == _HesabTafsili1Id_Bed && s.Id == _TakhfifId);
                    if (q_Takhfif != null)
                    {
                        txtDarsadTakhfifRadifi.Text = q_Takhfif.DarsadTakhfifRadifi.ToString();
                        txtDarsadTakhfifJamei.Text = q_Takhfif.DarsadTakhfifJamei.ToString();
                        txtAzTarikh.Text = q_Takhfif.AzTarikh.ToString();
                        txtTaTarikh.Text = q_Takhfif.TaTarikh.ToString();
                        //cmbTakhfif.ReadOnly = true;
                    }
                    else
                    {
                        txtDarsadTakhfifRadifi.Text = "0";
                        txtDarsadTakhfifJamei.Text = "0";
                        txtAzTarikh.Text = "";
                        txtTaTarikh.Text = "";
                    }

                }
                catch (Exception ex)
                {
                    XtraMessageBox.Show("عملیات با خطا مواجه شد" + "\n" + ex.Message,
                        "پیغام", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }


        }

        private void btnReloadTakhfif_Click(object sender, EventArgs e)
        {
            cmbTakhfif_EditValueChanged(null, null);
        }

        private void btnReloadEtebar_Click(object sender, EventArgs e)
        {
            cmbEtebar_EditValueChanged(null, null);
        }

        public void FillVaziyatHesab()
        {
            if (gridView1 != null)
            {
                if (objXtraTabPage_1 == xtp_AghlamKala)
                {
                    txtMabKhalesKala.Text = gridView1.Columns["MablagKhales_Kala"].SummaryText;
                    if (txtMabKhalesKala.Text == string.Empty) txtMabKhalesKala.Text = "0";
                    txtMabMaliat.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Maliat"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Maliat"].SummaryText)).ToString("n0");
                    if (txtMabMaliat.Text == string.Empty) txtMabMaliat.Text = "0";
                    txtMabAvarez.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Avarez"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Avarez"].SummaryText)).ToString("n0");
                    if (txtMabAvarez.Text == string.Empty) txtMabAvarez.Text = "0";

                }
                else if (objXtraTabPage_1 == xtp_AghlamKhadamat)
                {
                    txtMabKhalesKhadamat.Text = gridView1.Columns["MablagKhales_Khadamat"].SummaryText;
                    if (txtMabKhalesKhadamat.Text == string.Empty) txtMabKhalesKhadamat.Text = "0";
                    txtMabMaliat.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Maliat"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Maliat"].SummaryText)).ToString("n0");
                    if (txtMabMaliat.Text == string.Empty) txtMabMaliat.Text = "0";
                    txtMabAvarez.Text = (Convert.ToDecimal(gridView_AghlamKala.Columns["Avarez"].SummaryText) + Convert.ToDecimal(gridView_AghlamKhadamat.Columns["Avarez"].SummaryText)).ToString("n0");
                    if (txtMabAvarez.Text == string.Empty) txtMabAvarez.Text = "0";

                }
                else if (objXtraTabPage_1 == xtp_Ezafat)
                {
                    txtMabEzafat.Text = gridView1.Columns["Mablag"].SummaryText;
                    if (txtMabEzafat.Text == string.Empty) txtMabEzafat.Text = "0";
                    txtDarsadMabEzafat.Text = gridView1.Columns["Meghdar"].SummaryText;
                }
                else if (objXtraTabPage_1 == xtp_Ksorat)
                {
                    txtMabKsorat.Text = gridView1.Columns["Mablag"].SummaryText;
                    if (txtMabKsorat.Text == string.Empty) txtMabKsorat.Text = "0";
                    txtDarsadMabKsorat.Text = gridView1.Columns["Meghdar"].SummaryText;
                }
                //else if (objXtraTabPage_1 == xtp_Vizitor)
                //{
                //    txtJameAghlamKala.Text = gridView1.Columns["Mablag"].SummaryText;

                //}


                MohasebeJameMandeHesab();
            }
        }

        public void MohasebeJameMandeHesab()
        {
            txtJamMabKhales.Text = (Convert.ToDecimal(txtMabKhalesKala.Text.Replace(",", "")) + Convert.ToDecimal(txtMabKhalesKhadamat.Text.Replace(",", ""))).ToString("n0");
            txtJamColBaMaliat.Text = (Convert.ToDecimal(txtJamMabKhales.Text.Replace(",", "")) + Convert.ToDecimal(txtMabMaliat.Text.Replace(",", "")) + Convert.ToDecimal(txtMabAvarez.Text.Replace(",", ""))).ToString("n0");
            txtJamMabColFactor.Text = (Convert.ToDecimal(txtJamColBaMaliat.Text.Replace(",", "")) + Convert.ToDecimal(txtMabEzafat.Text.Replace(",", "")) - Convert.ToDecimal(txtMabKsorat.Text.Replace(",", ""))).ToString("n0");
            txtMandeBadeInFactor.Text = (Convert.ToDecimal(txtJamMabColFactor.Text.Replace(",", "")) + Convert.ToDecimal(txtMandeGhableInFactor.Text.Replace(",", ""))).ToString("n0");

        }

        private void FrmFactor_FormClosing(object sender, FormClosingEventArgs e)
        {
            if ((En1 == EnumCED.Create || En1 == EnumCED.Edit) && ClikBtnClosed == false)
            {
                if ((gridView_AghlamKala.RowCount > 0 && _NoeFactor == 0) || (gridView_AghlamKhadamat.RowCount > 0 && _NoeFactor == 1))
                {
                    var Result = XtraMessageBox.Show("آیا اطلاعات ذخیره گردد؟", "پیغام خروج", MessageBoxButtons.YesNoCancel, MessageBoxIcon.Information);
                    if (Result == DialogResult.Yes)
                    {
                        btnSaveAndClosed_Click(null, null);
                        En1 = EnumCED.Cancel;
                    }
                    else if (Result == DialogResult.No)
                    {
                        En1 = EnumCED.Cancel;
                    }
                }
                else
                {
                    En1 = EnumCED.Cancel;
                }

            }

        }

        private void chkEetebarat_CheckedChanged(object sender, EventArgs e)
        {
            chkEetebarat.Text = chkEetebarat.Checked ? "مبلغ اعتبار با احتساب مانده بدهی +مبلغ این فاکتور + جمع چکهای سررسید نشده می باشد" : "مبلغ اعتبار با احتساب مانده بدهی +مبلغ این فاکتور می باشد";
        }

        private void chkEditCodeTakhfif_CheckedChanged(object sender, EventArgs e)
        {
            cmbTakhfif.ReadOnly = chkEditCodeTakhfif.Checked? false:true;
        }

        private void cmbTakhfif_Leave(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(cmbTakhfif.Text))
                cmbTakhfif.EditValue = 0;

        }
    }
}